# 网络硬件技术

## 概述

网络硬件是数据中心互联的基础设施，涵盖网卡、交换机、路由器等核心设备。本文档深入解析网络硬件的技术架构、高速网络接口、智能网卡技术及企业级网络设备选型。

## 网卡技术

### 网卡类型演进

```yaml
网卡类型:
  传统网卡:
    速率: 1G/10G
    功能: 基础收发
    CPU占用: 高
    
  智能网卡 (SmartNIC):
    速率: 25G/100G/200G
    功能: 卸载TCP/IP、加密、负载均衡
    CPU占用: 低
    
  DPU (Data Processing Unit):
    速率: 100G/200G/400G
    功能: 完整网络/存储/安全卸载
    特点: 独立处理器、可编程
    
接口速率演进:
  1GbE: 2000年代主流
  10GbE: 2010年代主流
  25GbE: 当前服务器标配
  40GbE: 汇聚层应用
  100GbE: 高性能/汇聚层
  200GbE: 新一代高性能
  400GbE: 数据中心核心
```

### 高速网卡规格

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        服务器网卡规格对比                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  速率     │ 接口类型    │ PCIe需求   │ 延迟      │ 典型应用               │
│  ─────────┼─────────────┼────────────┼───────────┼───────────────────────│
│  10GbE    │ SFP+/RJ45   │ PCIe 2.0 x8│ ~5μs      │ 通用服务器             │
│  25GbE    │ SFP28       │ PCIe 3.0 x8│ ~2μs      │ 云服务器标配           │
│  40GbE    │ QSFP+       │ PCIe 3.0 x8│ ~2μs      │ 虚拟化/存储            │
│  100GbE   │ QSFP28/56   │ PCIe 4.0 x16│ ~1μs     │ 高性能计算            │
│  200GbE   │ QSFP56      │ PCIe 4.0 x16│ <1μs     │ AI/存储集群           │
│  400GbE   │ QSFP112/OSFP│ PCIe 5.0 x16│ <1μs     │ 下一代DC              │
│                                                                             │
│  光模块类型:                                                                │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │  SFP28 (25G):                                                       │    │
│  │    - 25GBASE-SR: 多模光纤, 100m                                    │    │
│  │    - 25GBASE-LR: 单模光纤, 10km                                    │    │
│  │                                                                     │    │
│  │  QSFP28 (100G):                                                     │    │
│  │    - 100GBASE-SR4: 4×25G多模, 100m                                 │    │
│  │    - 100GBASE-LR4: 4×25G单模, 10km                                 │    │
│  │    - 100GBASE-CWDM4: WDM单模, 2km                                  │    │
│  │                                                                     │    │
│  │  QSFP56 (200G):                                                     │    │
│  │    - 200GBASE-SR4: 4×50G多模                                       │    │
│  │    - 200GBASE-DR4: 4×50G单模                                       │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### RDMA技术

```yaml
RDMA (Remote Direct Memory Access):
  核心优势:
    - 零拷贝: 数据直接到达应用内存
    - 内核旁路: 绕过内核协议栈
    - CPU卸载: 网卡处理协议
    
  技术实现:
    InfiniBand:
      特点: 专用网络，最低延迟
      延迟: <1μs
      应用: HPC、AI训练
      
    RoCE (RDMA over Converged Ethernet):
      RoCE v1:
        封装: 以太网帧
        限制: 仅限二层
        
      RoCE v2:
        封装: UDP/IP
        优势: 可跨三层路由
        应用: 云数据中心主流
        
    iWARP:
      封装: TCP/IP
      特点: 可靠传输，兼容性好
      延迟: 略高于RoCE
      
  典型场景:
    存储网络: NVMe-oF, iSER
    数据库: Oracle RAC, SAP HANA
    AI训练: NCCL, MPI
    分布式存储: Ceph, HDFS
```

### 智能网卡 (SmartNIC)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        智能网卡架构                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      SmartNIC内部架构                                │   │
│  │                                                                       │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │                    可编程引擎                                │    │   │
│  │  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐       │    │   │
│  │  │  │ ARM核心  │ │ P4引擎   │ │ FPGA     │ │ ASIC     │       │    │   │
│  │  │  │ (通用)   │ │ (流处理) │ │ (可编程) │ │ (加速)   │       │    │   │
│  │  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘       │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                              │                                       │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │                    卸载功能                                  │    │   │
│  │  │  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐   │    │   │
│  │  │  │TCP卸载 │ │虚拟化  │ │加密    │ │压缩    │ │存储    │   │    │   │
│  │  │  │TSO/LRO │ │SR-IOV  │ │IPsec   │ │LZ4     │ │NVMe-oF │   │    │   │
│  │  │  │RSS/RFS │ │OVS卸载 │ │TLS     │ │Zstd    │ │iSCSI   │   │    │   │
│  │  │  └────────┘ └────────┘ └────────┘ └────────┘ └────────┘   │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  │                              │                                       │   │
│  │  ┌─────────────────────────────────────────────────────────────┐    │   │
│  │  │                    网络接口                                  │    │   │
│  │  │  ┌────────────────────────────────────────────────────┐     │    │   │
│  │  │  │  Port 1: 100GbE │  Port 2: 100GbE │  管理口: 1GbE  │     │    │   │
│  │  │  └────────────────────────────────────────────────────┘     │    │   │
│  │  └─────────────────────────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  主流SmartNIC产品:                                                          │
│  - NVIDIA BlueField-3: 400G, ARM核心, DPU                                  │
│  - Intel IPU: 200G, 可编程管道                                             │
│  - Broadcom Stingray: 100G, ARM核心                                        │
│  - AMD Pensando: 200G, P4可编程                                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 交换机技术

### 交换机层级

```yaml
数据中心交换机层级:
  核心层 (Spine):
    速率: 400G
    容量: 51.2Tbps+
    功能: 高速转发
    冗余: 多台热备
    
  汇聚层 (Leaf):
    速率: 100G上行, 25G下行
    容量: 12.8Tbps
    功能: 服务器接入
    密度: 32-64端口
    
  ToR (Top of Rack):
    速率: 25G服务器, 100G上行
    容量: 6.4Tbps
    功能: 机架内交换
    密度: 48端口
    
Spine-Leaf架构:
  优势:
    - 任意两点等距
    - 高带宽、低延迟
    - 易于扩展
    
  设计原则:
    - 非阻塞设计
    - ECMP负载均衡
    - 无STP依赖
```

### 主流交换机厂商

| 厂商 | 产品线 | 特点 | 市场定位 |
|------|--------|------|----------|
| Cisco | Nexus | 功能全面、企业级 | 传统企业 |
| Arista | 7000系列 | 高性能、云优化 | 云服务商 |
| Juniper | QFX系列 | 开放、可编程 | 企业/云 |
| Mellanox/NVIDIA | Spectrum | RDMA优化 | HPC/AI |
| H3C/华三 | S系列 | 性价比、本地化 | 中国市场 |
| 华为 | CloudEngine | 全栈、智能 | 全球/中国 |

## 网络布线

### 光纤类型

```yaml
光纤类型:
  多模光纤 (MMF):
    OM3:
      带宽: 2000 MHz·km
      距离: 100m @10G, 70m @100G
      颜色: 水绿色
      
    OM4:
      带宽: 4700 MHz·km
      距离: 150m @10G, 100m @100G
      颜色: 水绿色
      
    OM5:
      带宽: 28000 MHz·km
      距离: 150m @100G (SWDM)
      颜色: 酸橙绿
      特点: 支持CWDM
      
  单模光纤 (SMF):
    OS2:
      带宽: 无限制 (单一模式)
      距离: 10km+ @100G
      颜色: 黄色
      应用: 长距离传输
      
光纤接口:
  LC: 小型连接器，最常用
  MPO/MTP: 多芯连接器，高密度
  SC: 大型连接器，传统应用
```

### 高速线缆

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        数据中心布线方案                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  线缆类型:                                                                  │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │  DAC (Direct Attach Copper):                                        │    │
│  │    - 无源: 最大5m, 低功耗, 低成本                                  │    │
│  │    - 有源: 最大15m, 信号放大                                       │    │
│  │    - 应用: 机柜内短距离连接                                        │    │
│  │                                                                     │    │
│  │  AOC (Active Optical Cable):                                        │    │
│  │    - 距离: 最大100m                                                │    │
│  │    - 特点: 光电一体，即插即用                                      │    │
│  │    - 应用: 机柜间中距离连接                                        │    │
│  │                                                                     │    │
│  │  光模块 + 光纤:                                                     │    │
│  │    - 距离: 100m ~ 80km                                             │    │
│  │    - 特点: 灵活配置                                                │    │
│  │    - 应用: 跨建筑、跨园区                                          │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
│  推荐选择:                                                                  │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │  距离        │ 25G          │ 100G         │ 400G                  │    │
│  │  ────────────┼──────────────┼──────────────┼──────────────────     │    │
│  │  <3m         │ 无源DAC      │ 无源DAC      │ 无源DAC               │    │
│  │  3-7m        │ 有源DAC      │ 有源DAC      │ 有源DAC               │    │
│  │  7-30m       │ AOC          │ AOC          │ AOC                   │    │
│  │  30-100m     │ SR光模块     │ SR4光模块    │ SR8光模块             │    │
│  │  >100m       │ LR光模块     │ LR4光模块    │ DR4光模块             │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 网络硬件选型

### 网卡选型

```yaml
网卡选型指南:
  云服务器:
    推荐: 双口25G SFP28
    品牌: Intel E810, NVIDIA ConnectX-6
    功能: SR-IOV, DPDK支持
    
  数据库服务器:
    推荐: 双口25G/100G
    品牌: Mellanox ConnectX-6
    功能: RDMA, 低延迟
    
  存储服务器:
    推荐: 双口100G
    品牌: Mellanox ConnectX-6
    功能: NVMe-oF, iSER
    
  AI训练服务器:
    推荐: 多口200G/400G
    品牌: NVIDIA ConnectX-7
    功能: RDMA, GPUDirect
    
  虚拟化服务器:
    推荐: 双口25G SmartNIC
    品牌: NVIDIA BlueField-2
    功能: OVS卸载, 加密卸载
```

## 参考资源

- [IEEE 802.3 Ethernet Standards](https://www.ieee802.org/3/)
- [NVIDIA Networking Products](https://www.nvidia.com/en-us/networking/)
- [Intel Ethernet Products](https://www.intel.com/ethernet)
- [Arista Networks](https://www.arista.com/)
- [Open Compute Project Networking](https://www.opencompute.org/projects/networking)
