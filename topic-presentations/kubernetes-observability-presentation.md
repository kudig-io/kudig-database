# Kubernetes 可观测性全栈培训 (监控、日志、追踪)

> **适用版本**: Kubernetes v1.28 - v1.32 | **文档类型**: 运维可观测性专项
> **目标受众**: SRE、全栈开发、监控架构师
> **核心原则**: 黄金指标驱动、白盒监控、全链路追踪

---

## 🔰 第一阶段：什么是可观测性？

### 1.1 三大支柱
*   **Metrics (指标)**: “系统的体温计”，告诉我们系统发生了什么（如 CPU 90%）。
*   **Logging (日志)**: “系统的日记本”，告诉我们为什么发生（如报错堆栈）。
*   **Tracing (追踪)**: “系统的监控录像”，告诉我们流量在微服务间的流转路径。

### 1.2 监控的分层
*   **基础架构层**: Node, CPU, Mem, Network。
*   **容器/Pod 层**: 重启次数、资源限额。
*   **应用层**: QPS, 响应时间, 错误率。

---

## 📘 第二阶段：Prometheus 监控实战

### 2.1 核心架构
*   **Pull 模式**: Prometheus 主动拉取指标。
*   **Exporter**: 负责把非 Prometheus 格式的指标转化出来（如 NodeExporter）。
*   **ServiceMonitor**: Operator 模式下的自动化监控发现。

### 2.2 黄金指标 (Golden Signals)
*   **Latency**: 响应时间。
*   **Traffic**: 并发量。
*   **Errors**: 错误率。
*   **Saturation**: 饱和度（资源剩余情况）。

---

## ⚡ 第三阶段：日志与链路追踪

### 3.1 日志采集方案 (PLG/ELK)
*   **Sidecar 模式**: 容器内起采集进程（性能高，隔离好）。
*   **DaemonSet 模式**: 每节点一个采集器（资源省，通用性强）。

### 3.2 全链路追踪 (Tracing)
*   **Jaeger / OpenTelemetry**: 解决微服务环境下的“谁慢了”问题。

---

## 🛠️ 第四阶段：告警管理与自愈

### 4.1 告警质量
*   **无意义告警 = 狼来了**: 只有需要人工介入的操作才发告警。
*   **告警收敛**: 避免告警风暴。

### 🏆 SRE 运维红线
*   *红线 1: 监控系统必须独立于业务集群部署（或至少存储独立）。*
*   *红线 2: 核心业务必须有对应的可视化看板。*
*   *红线 3: 任何告警必须有明确的 SOP 处理流程。*
