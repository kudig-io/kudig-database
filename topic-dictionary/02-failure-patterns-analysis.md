# 02 - Kubernetes æ•…éšœæ¨¡å¼ä¸æ ¹å› åˆ†æå­—å…¸

> **é€‚ç”¨ç‰ˆæœ¬**: Kubernetes v1.25-v1.32 | **æœ€åæ›´æ–°**: 2026-02 | **ä½œè€…**: Allen Galler | **è´¨é‡ç­‰çº§**: â­â­â­â­â­ ä¸“å®¶çº§

> **ç”Ÿäº§ç¯å¢ƒæ•…éšœå®æˆ˜ç»éªŒ**: åŸºäºåƒæ¬¡çœŸå®æ•…éšœå¤„ç†ç»éªŒæ€»ç»“ï¼Œæ¶µç›–ä»åˆçº§åˆ°é«˜çº§çš„å®Œæ•´æ•…éšœåˆ†æä½“ç³»

---

## ç›®å½•

- [1. å¸¸è§æ•…éšœæ¨¡å¼åˆ†ç±»](#1-å¸¸è§æ•…éšœæ¨¡å¼åˆ†ç±»)
- [2. æ ¹å› åˆ†ææ–¹æ³•è®º](#2-æ ¹å› åˆ†ææ–¹æ³•è®º)
- [3. æ•…éšœæ ‘åˆ†æ(FMEA)](#3-æ•…éšœæ ‘åˆ†æfmea)
- [4. MTTRä¼˜åŒ–ç­–ç•¥](#4-mtträ¼˜åŒ–ç­–ç•¥)
- [5. æ•…éšœå¤ç›˜æ¨¡æ¿](#5-æ•…éšœå¤ç›˜æ¨¡æ¿)
- [6. é¢„é˜²æªæ–½ä½“ç³»](#6-é¢„é˜²æªæ–½ä½“ç³»)

---

## 1. å¸¸è§æ•…éšœæ¨¡å¼åˆ†ç±»

### 1.1 æ§åˆ¶å¹³é¢æ•…éšœæ¨¡å¼

| æ•…éšœæ¨¡å¼ | ç—‡çŠ¶è¡¨ç° | å½±å“èŒƒå›´ | ç´§æ€¥ç¨‹åº¦ | å¸¸è§æ ¹å›  |
|---------|---------|---------|---------|---------|
| **API Serveræ— å“åº”** | kubectlå‘½ä»¤è¶…æ—¶ã€é›†ç¾¤æ— æ³•ç®¡ç† | å…¨é›†ç¾¤ | P0 | è¯ä¹¦è¿‡æœŸã€èµ„æºè€—å°½ã€ç½‘ç»œä¸­æ–­ |
| **etcdæ•°æ®ä¸ä¸€è‡´** | æ•°æ®è¯»å–å¼‚å¸¸ã€é›†ç¾¤çŠ¶æ€æ··ä¹± | å…¨é›†ç¾¤ | P0 | ç½‘ç»œåˆ†åŒºã€ç£ç›˜æ•…éšœã€é…ç½®é”™è¯¯ |
| **è°ƒåº¦å™¨å¤±æ•ˆ** | Podé•¿æœŸPendingã€æ— æ³•è°ƒåº¦ | æ–°Podåˆ›å»º | P1 | é…ç½®é”™è¯¯ã€èµ„æºä¸è¶³ã€æ’ä»¶å†²çª |
| **æ§åˆ¶å™¨ç®¡ç†å™¨å¡é¡¿** | èµ„æºçŠ¶æ€ä¸æ›´æ–°ã€æ§åˆ¶å™¨å¤±æ•ˆ | å¯¹åº”èµ„æº | P1 | å†…å­˜æ³„æ¼ã€APIè¿æ¥å¼‚å¸¸ã€æ­»é” |

### 1.2 èŠ‚ç‚¹å±‚é¢æ•…éšœæ¨¡å¼

| æ•…éšœæ¨¡å¼ | ç—‡çŠ¶è¡¨ç° | å½±å“èŒƒå›´ | ç´§æ€¥ç¨‹åº¦ | å¸¸è§æ ¹å›  |
|---------|---------|---------|---------|---------|
| **èŠ‚ç‚¹NotReady** | NodeçŠ¶æ€å¼‚å¸¸ã€Podé©±é€ | èŠ‚ç‚¹ä¸Šæ‰€æœ‰Pod | P0 | kubeletå´©æºƒã€ç½‘ç»œä¸­æ–­ã€èµ„æºè€—å°½ |
| **å®¹å™¨è¿è¡Œæ—¶å¼‚å¸¸** | Podå¯åŠ¨å¤±è´¥ã€å®¹å™¨æ— æ³•åˆ›å»º | èŠ‚ç‚¹å®¹å™¨æ“ä½œ | P1 | Docker daemonæ•…éšœã€é•œåƒæŸåã€å­˜å‚¨é—®é¢˜ |
| **kube-proxyå¤±æ•ˆ** | Serviceè®¿é—®å¼‚å¸¸ã€ç½‘ç»œä¸é€š | èŠ‚ç‚¹ç½‘ç»œä»£ç† | P1 | é…ç½®é”™è¯¯ã€iptablesè§„åˆ™æŸåã€èµ„æºé™åˆ¶ |
| **ç£ç›˜ç©ºé—´ä¸è¶³** | Pod Evictedã€å†™å…¥å¤±è´¥ | èŠ‚ç‚¹å­˜å‚¨ | P1 | æ—¥å¿—è†¨èƒ€ã€é•œåƒç¼“å­˜è¿‡å¤šã€ä¸´æ—¶æ–‡ä»¶ç´¯ç§¯ |

### 1.3 åº”ç”¨å±‚é¢æ•…éšœæ¨¡å¼

| æ•…éšœæ¨¡å¼ | ç—‡çŠ¶è¡¨ç° | å½±å“èŒƒå›´ | ç´§æ€¥ç¨‹åº¦ | å¸¸è§æ ¹å›  |
|---------|---------|---------|---------|---------|
| **Podé¢‘ç¹é‡å¯** | CrashLoopBackOffçŠ¶æ€ | å•ä¸ªåº”ç”¨ | P1 | åº”ç”¨Bugã€èµ„æºé…ç½®ä¸å½“ã€ä¾èµ–æœåŠ¡å¼‚å¸¸ |
| **æœåŠ¡å“åº”è¶…æ—¶** | è¯·æ±‚è¶…æ—¶ã€5xxé”™è¯¯å¢å¤š | ç”¨æˆ·ä½“éªŒ | P1 | èµ„æºä¸è¶³ã€ç½‘ç»œå»¶è¿Ÿã€åç«¯æœåŠ¡æ…¢ |
| **å†…å­˜æº¢å‡º(OOM)** | ContainerStatusUnknownã€è¿›ç¨‹è¢«æ€ | åº”ç”¨ç¨³å®šæ€§ | P0 | å†…å­˜æ³„æ¼ã€é™åˆ¶è®¾ç½®è¿‡ä½ã€æµé‡çªå¢ |
| **é…ç½®é”™è¯¯** | åº”ç”¨å¯åŠ¨å¤±è´¥ã€åŠŸèƒ½å¼‚å¸¸ | é…ç½®ç›¸å…³åŠŸèƒ½ | P2 | ConfigMap/Secretæ›´æ–°é”™è¯¯ã€ç¯å¢ƒå˜é‡ç¼ºå¤± |

### 1.4 ç½‘ç»œæ•…éšœæ¨¡å¼

| æ•…éšœæ¨¡å¼ | ç—‡çŠ¶è¡¨ç° | å½±å“èŒƒå›´ | ç´§æ€¥ç¨‹åº¦ | å¸¸è§æ ¹å›  |
|---------|---------|---------|---------|---------|
| **DNSè§£æå¤±è´¥** | æœåŠ¡åæ— æ³•è§£æã€è¿æ¥è¶…æ—¶ | å…¨éƒ¨æœåŠ¡é—´é€šä¿¡ | P0 | CoreDNSæ•…éšœã€ç½‘ç»œç­–ç•¥é˜»æ­¢ã€é…ç½®é”™è¯¯ |
| **ç½‘ç»œç­–ç•¥é˜»æ–­** | Podé—´é€šä¿¡å¼‚å¸¸ã€è®¿é—®è¢«æ‹’ç» | å—ç­–ç•¥å½±å“çš„é€šä¿¡ | P1 | NetworkPolicyé…ç½®é”™è¯¯ã€æ ‡ç­¾åŒ¹é…é—®é¢˜ |
| **CNIæ’ä»¶æ•…éšœ** | Podæ— æ³•è·å–IPã€ç½‘ç»œä¸é€š | æ–°Podç½‘ç»œ | P0 | CNIé…ç½®é”™è¯¯ã€IPåœ°å€è€—å°½ã€æ’ä»¶ç‰ˆæœ¬ä¸å…¼å®¹ |
| **Serviceè®¿é—®å¼‚å¸¸** | ClusterIPæ— æ³•è®¿é—®ã€è´Ÿè½½å‡è¡¡å¤±æ•ˆ | æœåŠ¡æš´éœ² | P1 | kube-proxyé—®é¢˜ã€Endpointsä¸ºç©ºã€ç«¯å£å†²çª |

### 1.5 å­˜å‚¨æ•…éšœæ¨¡å¼

| æ•…éšœæ¨¡å¼ | ç—‡çŠ¶è¡¨ç° | å½±å“èŒƒå›´ | ç´§æ€¥ç¨‹åº¦ | å¸¸è§æ ¹å›  |
|---------|---------|---------|---------|---------|
| **PVCç»‘å®šå¤±è´¥** | Podå¡åœ¨ContainerCreating | ä½¿ç”¨æŒä¹…åŒ–çš„åº”ç”¨ | P1 | StorageClassé…ç½®é”™è¯¯ã€å­˜å‚¨åç«¯æ•…éšœã€é…é¢é™åˆ¶ |
| **PVæŒ‚è½½è¶…æ—¶** | VolumeæŒ‚è½½å¤±è´¥ã€Podå¯åŠ¨ç¼“æ…¢ | å­˜å‚¨ä¾èµ–çš„åº”ç”¨ | P1 | CSIé©±åŠ¨é—®é¢˜ã€ç½‘ç»œå­˜å‚¨å»¶è¿Ÿã€æƒé™é…ç½®é”™è¯¯ |
| **å­˜å‚¨IOæ€§èƒ½å·®** | åº”ç”¨å“åº”æ…¢ã€æ•°æ®åº“è¶…æ—¶ | å­˜å‚¨å¯†é›†å‹åº”ç”¨ | P2 | å­˜å‚¨ç±»å‹é€‰æ‹©ä¸å½“ã€IOäº‰ç”¨ã€å­˜å‚¨åç«¯æ€§èƒ½ç“¶é¢ˆ |
| **æ•°æ®ä¸¢å¤±é£é™©** | PVåˆ é™¤ã€å¿«ç…§å¤±è´¥ | é‡è¦æ•°æ® | P0 | è¯¯æ“ä½œã€å¤‡ä»½ç­–ç•¥ç¼ºå¤±ã€å­˜å‚¨æ•…éšœ |

---

## 2. æ ¹å› åˆ†ææ–¹æ³•è®º

### 2.1 5 Whyåˆ†ææ³•

```markdown
æ•…éšœç°è±¡: Podå¤„äºCrashLoopBackOffçŠ¶æ€

Why 1: ä¸ºä»€ä¹ˆPodä¼šé‡å¯ï¼Ÿ
   â†’ å®¹å™¨ä¸»è¿›ç¨‹é€€å‡ºï¼Œé€€å‡ºç 1

Why 2: ä¸ºä»€ä¹ˆä¸»è¿›ç¨‹ä¼šé€€å‡ºï¼Ÿ
   â†’ åº”ç”¨å¯åŠ¨æ—¶æ•°æ®åº“è¿æ¥å¤±è´¥

Why 3: ä¸ºä»€ä¹ˆæ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ
   â†’ è¿æ¥å­—ç¬¦ä¸²é…ç½®é”™è¯¯

Why 4: ä¸ºä»€ä¹ˆè¿æ¥å­—ç¬¦ä¸²é…ç½®é”™è¯¯ï¼Ÿ
   â†’ ConfigMapä¸­çš„æ•°æ®åº“åœ°å€è¢«é”™è¯¯ä¿®æ”¹

Why 5: ä¸ºä»€ä¹ˆConfigMapä¼šè¢«é”™è¯¯ä¿®æ”¹ï¼Ÿ
   â†’ éƒ¨ç½²æµç¨‹ç¼ºä¹é…ç½®å®¡æ ¸æœºåˆ¶

æ ¹æœ¬åŸå› : ç¼ºä¹é…ç½®å˜æ›´å®¡æ ¸æµç¨‹å¯¼è‡´çš„é…ç½®é”™è¯¯
è§£å†³æ–¹æ¡ˆ: å»ºç«‹é…ç½®å˜æ›´å®¡æ‰¹æµç¨‹ï¼Œå¢åŠ é…ç½®éªŒè¯æ£€æŸ¥ç‚¹
```

### 2.2 é±¼éª¨å›¾åˆ†ææ³•

```
                    Podå¯åŠ¨å¤±è´¥
                        |
    ---------------------------------------------------
    |                  |                |             |
äººå‘˜å› ç´             æµç¨‹å› ç´           æŠ€æœ¯å› ç´       ç¯å¢ƒå› ç´ 
    |                  |                |             |
é…ç½®é”™è¯¯        ç¼ºä¹è‡ªåŠ¨åŒ–æµ‹è¯•      ç‰ˆæœ¬ä¸å…¼å®¹    ç½‘ç»œä¸­æ–­
äººä¸ºæ“ä½œå¤±è¯¯      éƒ¨ç½²æµç¨‹ä¸è§„èŒƒ      èµ„æºä¸è¶³      ç£ç›˜æ»¡
æƒé™é…ç½®é”™è¯¯      ç¼ºä¹ç°åº¦å‘å¸ƒ       ä¾èµ–æœåŠ¡å¼‚å¸¸   DNSè§£æå¤±è´¥
```

### 2.3 æ—¶é—´çº¿åˆ†ææ³•

```markdown
æ•…éšœæ—¶é—´çº¿åˆ†ææ¨¡æ¿:

æ—¶é—´æˆ³ | äº‹ä»¶æè¿° | æ“ä½œè€… | å½±å“è¯„ä¼°
-------|---------|--------|----------
10:00:00 | ç›‘æ§å‘Šè­¦: API Serverå“åº”å»¶è¿Ÿ > 2s | ç³»ç»Ÿè‡ªåŠ¨ | åˆæœŸå¾å…†
10:02:00 | ç”¨æˆ·æŠ¥å‘Šéƒ¨åˆ†æœåŠ¡è®¿é—®ç¼“æ…¢ | ç”¨æˆ·åé¦ˆ | å½±å“æ‰©å¤§
10:05:00 | å‘ç°API Server CPUä½¿ç”¨ç‡95% | è¿ç»´äººå‘˜ | ç¡®è®¤æ•…éšœ
10:07:00 | æ£€æŸ¥å‘ç°å¤§é‡LISTè¯·æ±‚ | è¿ç»´äººå‘˜ | å®šä½æ–¹å‘
10:10:00 | å‘ç°æŸä¸ªControllerå¼‚å¸¸é«˜é¢‘æŸ¥è¯¢ | å·¥ç¨‹å¸ˆA | æ ¹å› æ¥è¿‘
10:15:00 | é‡å¯å¼‚å¸¸Controller Pod | è¿ç»´å›¢é˜Ÿ | ä¸´æ—¶ç¼“è§£
10:20:00 | æœåŠ¡æ¢å¤æ­£å¸¸ | ç³»ç»Ÿè‡ªåŠ¨ | æ•…éšœæ¢å¤
10:30:00 | ä¿®å¤Controller Bugå¹¶å‘å¸ƒ | å¼€å‘å›¢é˜Ÿ | æ ¹æœ¬è§£å†³
```

### 2.4 å½±å“é¢åˆ†æçŸ©é˜µ

| å½±å“ç»´åº¦ | ä¸¥é‡ç¨‹åº¦ | å½±å“èŒƒå›´ | æŒç»­æ—¶é—´ | ä¸šåŠ¡æŸå¤± |
|---------|---------|---------|---------|---------|
| **ç”¨æˆ·ä½“éªŒ** | é«˜ | 80%ç”¨æˆ· | 20åˆ†é’Ÿ | Â¥50,000 |
| **æ•°æ®å®Œæ•´æ€§** | ä¸­ | éƒ¨åˆ†äº¤æ˜“æ•°æ® | çŸ­æš‚ | Â¥10,000 |
| **ç³»ç»Ÿå¯ç”¨æ€§** | é«˜ | æ ¸å¿ƒæœåŠ¡ | 20åˆ†é’Ÿ | Â¥100,000 |
| **å“ç‰Œå£°èª‰** | ä¸­ | å…¬å¼€æœåŠ¡ | æŒç»­å½±å“ | Â¥30,000 |

---

## 3. æ•…éšœæ ‘åˆ†æ(FMEA)

### 3.1 FMEAåˆ†ææ¨¡æ¿

```markdown
æ•…éšœæ¨¡å¼: API Serverå®Œå…¨ä¸å¯ç”¨

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      é¡¶å±‚æ•…éšœäº‹ä»¶                            â”‚
â”‚                   API Server Down (100%)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼                 â–¼
   ç¡¬ä»¶æ•…éšœ(30%)      è½¯ä»¶æ•…éšœ(50%)      é…ç½®æ•…éšœ(20%)
        â”‚                 â”‚                 â”‚
  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
  â–¼           â–¼    â–¼           â–¼    â–¼           â–¼
ç£ç›˜æ•…éšœ   ç½‘å¡æ•…éšœ  å†…å­˜æ³„æ¼   æ­»é”   è¯ä¹¦è¿‡æœŸ   å‚æ•°é”™è¯¯
(15%)     (15%)   (25%)     (25%)   (12%)     (8%)

é£é™©ä¼˜å…ˆçº§æ•°(RPN) = ä¸¥é‡åº¦(S) Ã— å‘ç”Ÿé¢‘åº¦(O) Ã— æ£€æµ‹éš¾åº¦(D)

é£é™©è¯„ä¼°:
- å†…å­˜æ³„æ¼: RPN = 9Ã—8Ã—7 = 504 (é«˜é£é™©)
- è¯ä¹¦è¿‡æœŸ: RPN = 8Ã—6Ã—2 = 96 (ä¸­é£é™©)
- ç£ç›˜æ•…éšœ: RPN = 9Ã—4Ã—8 = 288 (ä¸­é«˜é£é™©)
```

### 3.2 å…³é”®æ•…éšœè·¯å¾„åˆ†æ

```mermaid
graph TD
    A[ç”¨æˆ·è¯·æ±‚å¤±è´¥] --> B{æœåŠ¡æ˜¯å¦å¯è¾¾?}
    B -->|å¦| C[ç½‘ç»œå±‚æ•…éšœ]
    B -->|æ˜¯| D{API Serverå“åº”?}
    D -->|å¦| E[æ§åˆ¶å¹³é¢æ•…éšœ]
    D -->|æ˜¯| F{Podæ˜¯å¦è¿è¡Œ?}
    F -->|å¦| G[è°ƒåº¦å±‚æ•…éšœ]
    F -->|æ˜¯| H{åº”ç”¨æ˜¯å¦å¥åº·?}
    H -->|å¦| I[åº”ç”¨å±‚æ•…éšœ]
    H -->|æ˜¯| J[æ­£å¸¸å“åº”]
    
    C --> C1[DNSè§£æå¤±è´¥]
    C --> C2[CNIæ’ä»¶å¼‚å¸¸]
    C --> C3[ç½‘ç»œç­–ç•¥é˜»æ–­]
    
    E --> E1[API Serverå´©æºƒ]
    E --> E2[etcdæ•°æ®å¼‚å¸¸]
    E --> E3[è®¤è¯æˆæƒå¤±è´¥]
    
    G --> G1[èµ„æºä¸è¶³]
    G --> G2[èŠ‚ç‚¹NotReady]
    G --> G3[æ±¡ç‚¹é…ç½®é”™è¯¯]
    
    I --> I1[å†…å­˜æº¢å‡º]
    I --> I2[é…ç½®é”™è¯¯]
    I --> I3[ä¾èµ–æœåŠ¡å¼‚å¸¸]
```

---

## 4. MTTRä¼˜åŒ–ç­–ç•¥

### 4.1 æ•…éšœå‘ç°ä¼˜åŒ–

```yaml
# ========== æ™ºèƒ½å‘Šè­¦é…ç½® ==========
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: intelligent-alerting
  namespace: monitoring
spec:
  groups:
  - name: fault-detection.rules
    rules:
    # åŸºç¡€æŒ‡æ ‡å¼‚å¸¸æ£€æµ‹
    - alert: AnomalousCPULoad
      expr: |
        avg_over_time(rate(container_cpu_usage_seconds_total[5m])[1h:5m])
        * 2 < rate(container_cpu_usage_seconds_total[5m])
      for: 2m
      labels:
        severity: warning
      annotations:
        summary: "CPUä½¿ç”¨å‡ºç°å¼‚å¸¸å¢é•¿æ¨¡å¼"
        
    # å¤šæŒ‡æ ‡å…³è”åˆ†æ
    - alert: ServiceDegradationPattern
      expr: |
        (rate(http_requests_total{code=~"5.."}[5m]) > 0.1)
        and
        (avg(etcd_disk_backend_commit_duration_seconds) > 0.1)
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: "æœåŠ¡é™çº§æ¨¡å¼æ£€æµ‹åˆ°"
        
    # é¢„æµ‹æ€§å‘Šè­¦
    - alert: PredictiveFailure
      expr: |
        predict_linear(node_filesystem_free_bytes[1h], 4*3600) < 0
      for: 10m
      labels:
        severity: warning
      annotations:
        summary: "é¢„æµ‹4å°æ—¶åç£ç›˜å°†æ»¡"
```

### 4.2 æ•…éšœå®šä½åŠ é€Ÿ

```bash
#!/bin/bash
# ========== å¿«é€Ÿæ•…éšœè¯Šæ–­è„šæœ¬ ==========
set -euo pipefail

CLUSTER_NAME=${1:-"production"}
NAMESPACE=${2:-"default"}

echo "=== Kuberneteså¿«é€Ÿè¯Šæ–­æŠ¥å‘Š ==="
echo "é›†ç¾¤: $CLUSTER_NAME"
echo "å‘½åç©ºé—´: $NAMESPACE"
echo "è¯Šæ–­æ—¶é—´: $(date)"
echo ""

# 1. æ§åˆ¶å¹³é¢å¥åº·æ£€æŸ¥
echo "1. æ§åˆ¶å¹³é¢çŠ¶æ€æ£€æŸ¥"
kubectl get componentstatuses -o wide || echo "âœ— æ— æ³•è·å–ç»„ä»¶çŠ¶æ€"

# 2. èŠ‚ç‚¹çŠ¶æ€æ£€æŸ¥
echo -e "\n2. èŠ‚ç‚¹å¥åº·æ£€æŸ¥"
kubectl get nodes -o wide | grep -E "(NotReady|SchedulingDisabled)"

# 3. å¼‚å¸¸Podæ£€æŸ¥
echo -e "\n3. å¼‚å¸¸Podæ£€æŸ¥"
kubectl get pods -A --field-selector=status.phase!=Running -o wide

# 4. èµ„æºä½¿ç”¨æƒ…å†µ
echo -e "\n4. èµ„æºä½¿ç”¨æ¦‚å†µ"
kubectl top nodes | head -10
kubectl top pods -A | head -10

# 5. äº‹ä»¶åˆ†æ
echo -e "\n5. æœ€è¿‘å¼‚å¸¸äº‹ä»¶"
kubectl get events -A --sort-by='.lastTimestamp' | tail -20

# 6. ç½‘ç»œè¿é€šæ€§æ£€æŸ¥
echo -e "\n6. DNSå’ŒæœåŠ¡è¿é€šæ€§"
kubectl run -it --rm debug-pod --image=curlimages/curl --restart=Never \
  -- curl -s -o /dev/null -w "%{http_code}" kubernetes.default.svc.cluster.local

# 7. å­˜å‚¨çŠ¶æ€æ£€æŸ¥
echo -e "\n7. å­˜å‚¨èµ„æºçŠ¶æ€"
kubectl get pv,pvc -A | grep -E "(Failed|Pending|Lost)"

echo -e "\n=== è¯Šæ–­å®Œæˆ ==="
```

### 4.3 è‡ªåŠ¨åŒ–ä¿®å¤æœºåˆ¶

```yaml
# ========== è‡ªæ„ˆOperatoré…ç½® ==========
apiVersion: autoscaling.k8s.io/v1
kind: SelfHealingRule
metadata:
  name: pod-auto-healing
  namespace: production
spec:
  selector:
    matchLabels:
      auto-healing: enabled
  rules:
  - condition: PodRestartCount > 5
    action: RestartPod
    cooldown: 300s
    
  - condition: ContainerMemoryUsage > 90%
    action: ScaleMemoryLimit
    increment: 20%
    maxLimit: 4Gi
    
  - condition: PodNotReadyDuration > 300s
    action: RecreatePod
    gracePeriod: 30s

---
# ========== Chaos Engineeringé…ç½® ==========
apiVersion: chaos-mesh.org/v1alpha1
kind: PodChaos
metadata:
  name: pod-kill-example
  namespace: chaos-testing
spec:
  action: pod-kill
  mode: one
  selector:
    namespaces:
    - production
    labelSelectors:
      app: critical-service
  scheduler:
    cron: "@every 12h"  # å®šæœŸæ•…éšœæ³¨å…¥æµ‹è¯•
```

---

## 5. æ•…éšœå¤ç›˜æ¨¡æ¿

### 5.1 SORå¤ç›˜æ¡†æ¶

```markdown
# SOR (Summary of Restoration) æ•…éšœå¤ç›˜æŠ¥å‘Š

## åŸºæœ¬ä¿¡æ¯
- **æ•…éšœç¼–å·**: INC-20260205-001
- **æ•…éšœæ—¶é—´**: 2026-02-05 14:30 - 14:50 (20åˆ†é’Ÿ)
- **æ•…éšœç­‰çº§**: P0 - æ ¸å¿ƒæœåŠ¡ä¸­æ–­
- **å½±å“èŒƒå›´**: ç”¨æˆ·æ³¨å†ŒæœåŠ¡100%ä¸å¯ç”¨
- **ä¸šåŠ¡æŸå¤±**: çº¦Â¥200,000

## æ•…éšœè¿‡ç¨‹æ—¶é—´çº¿

### å‘ç°é˜¶æ®µ (14:30-14:32)
- 14:30:00 - ç›‘æ§ç³»ç»Ÿå‘Šè­¦ï¼šæ³¨å†ŒæœåŠ¡HTTP 500é”™è¯¯ç‡95%
- 14:30:30 - ç”¨æˆ·æŠ•è¯‰æ¿€å¢ï¼Œå®¢æœç³»ç»ŸæŠ¥è­¦
- 14:32:00 - SREå›¢é˜Ÿä»‹å…¥è°ƒæŸ¥

### å®šä½é˜¶æ®µ (14:32-14:38)
- 14:32:30 - ç¡®è®¤PodçŠ¶æ€æ­£å¸¸ï¼Œä½†æœåŠ¡æ— å“åº”
- 14:34:15 - å‘ç°åº”ç”¨æ—¥å¿—å¤§é‡æ•°æ®åº“è¿æ¥è¶…æ—¶
- 14:36:45 - ç¡®è®¤æ•°æ®åº“è¿æ¥æ± è€—å°½
- 14:38:20 - å®šä½åˆ°è¿æ¥æ± é…ç½®è¢«æ„å¤–ä¿®æ”¹

### å¤„ç†é˜¶æ®µ (14:38-14:48)
- 14:38:45 - ç´§æ€¥å›æ»šé…ç½®å˜æ›´
- 14:40:15 - é‡å¯åº”ç”¨Podæ¢å¤è¿æ¥æ± 
- 14:43:30 - é€æ­¥æ¢å¤æœåŠ¡æµé‡
- 14:48:00 - æœåŠ¡å®Œå…¨æ¢å¤æ­£å¸¸

### éªŒè¯é˜¶æ®µ (14:48-14:50)
- 14:48:30 - ç›‘æ§æŒ‡æ ‡å›å½’æ­£å¸¸
- 14:49:15 - ç”¨æˆ·åŠŸèƒ½éªŒè¯é€šè¿‡
- 14:50:00 - æ•…éšœæ­£å¼å…³é—­

## æ ¹å› åˆ†æ

### ç›´æ¥åŸå› 
é…ç½®ç®¡ç†æµç¨‹ç¼ºé™·å¯¼è‡´æ•°æ®åº“è¿æ¥æ± å¤§å°è¢«é”™è¯¯ä¿®æ”¹ï¼ˆä»20é™è‡³5ï¼‰

### æ ¹æœ¬åŸå› 
1. ç¼ºä¹é…ç½®å˜æ›´çš„è‡ªåŠ¨åŒ–éªŒè¯æœºåˆ¶
2. ç¯å¢ƒé—´é…ç½®åŒæ­¥ç¼ºå°‘å®¡æ‰¹æµç¨‹
3. ç›‘æ§å‘Šè­¦é˜ˆå€¼è®¾ç½®ä¸å¤Ÿæ•æ„Ÿ

### è´¡çŒ®å› ç´ 
- å˜æ›´çª—å£é€‰æ‹©ä¸å½“ï¼ˆä¸šåŠ¡é«˜å³°æœŸï¼‰
- ç¼ºä¹å˜æ›´å‰çš„å®¹é‡è¯„ä¼°
- å›æ»šé¢„æ¡ˆå‡†å¤‡ä¸å……åˆ†

## å½±å“è¯„ä¼°

### ä¸šåŠ¡å½±å“
- ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½å®Œå…¨ä¸å¯ç”¨ 20åˆ†é’Ÿ
- æ–°ç”¨æˆ·æµå¤±é¢„è®¡ 500+
- å“ç‰Œå£°èª‰å—æŸ

### æŠ€æœ¯å½±å“
- æœåŠ¡å¯ç”¨æ€§ 99.96% â†’ 99.93%
- SLAè¿çº¦é£é™©å¢åŠ 
- å›¢é˜Ÿåº”æ€¥å“åº”å‹åŠ›å¢å¤§

## æ”¹è¿›æªæ–½

### çŸ­æœŸæªæ–½ (1å‘¨å†…)
- [ ] å»ºç«‹é…ç½®å˜æ›´å®¡æ‰¹æµç¨‹
- [ ] å¢åŠ é…ç½®éªŒè¯è‡ªåŠ¨åŒ–æµ‹è¯•
- [ ] ä¼˜åŒ–ç›‘æ§å‘Šè­¦é˜ˆå€¼

### ä¸­æœŸæªæ–½ (1ä¸ªæœˆå†…)
- [ ] å®æ–½é…ç½®ç®¡ç†å¹³å°
- [ ] å»ºç«‹å˜æ›´å½±å“è¯„ä¼°æœºåˆ¶
- [ ] å®Œå–„åº”æ€¥é¢„æ¡ˆå’Œæ¼”ç»ƒ

### é•¿æœŸæªæ–½ (3ä¸ªæœˆå†…)
- [ ] å¼•å…¥é…ç½®æ¼‚ç§»æ£€æµ‹å·¥å…·
- [ ] å»ºç«‹é…ç½®æ²»ç†å§”å‘˜ä¼š
- [ ] å®ç°æ™ºèƒ½å˜æ›´é£é™©è¯„ä¼°

## ç»éªŒæ•™è®­

### åšå¾—å¥½çš„æ–¹é¢
- ç›‘æ§å‘Šè­¦åŠæ—¶å‡†ç¡®
- å›¢é˜Ÿå“åº”é€Ÿåº¦å¿«
- æ²Ÿé€šåè°ƒé¡ºç•…

### éœ€è¦æ”¹è¿›çš„æ–¹é¢
- å˜æ›´ç®¡ç†æµç¨‹éœ€è¦å®Œå–„
- è‡ªåŠ¨åŒ–ç¨‹åº¦æœ‰å¾…æé«˜
- é¢„é˜²æ€§æªæ–½ä¸è¶³

## åç»­è·Ÿè¸ª
- è´£ä»»äºº: å¼ ä¸‰ (SRE Team Lead)
- è·Ÿè¸ªå‘¨æœŸ: æ¯å‘¨æ£€æŸ¥æ”¹è¿›æªæ–½è¿›å±•
- ä¸‹æ¬¡å¤ç›˜: 2026-03-05
```

### 5.2 RCA (Root Cause Analysis) æ¨¡æ¿

```markdown
# æ ¹å› åˆ†ææŠ¥å‘Š (RCA)

## æ•…éšœæ¦‚è¿°
**æ ‡é¢˜**: æ•°æ®åº“è¿æ¥æ± è€—å°½å¯¼è‡´æœåŠ¡ä¸­æ–­
**å‘ç”Ÿæ—¶é—´**: 2026-02-05 14:30-14:50
**å½±å“**: ç”¨æˆ·æ³¨å†ŒæœåŠ¡å®Œå…¨ä¸å¯ç”¨

## é—®é¢˜æè¿°
åº”ç”¨æœåŠ¡ç”±äºæ•°æ®åº“è¿æ¥æ± é…ç½®é”™è¯¯ï¼Œå¯¼è‡´è¿æ¥æ•°ä¸è¶³ï¼Œæ–°è¯·æ±‚æ— æ³•è·å–æ•°æ®åº“è¿æ¥ï¼Œæœ€ç»ˆæœåŠ¡ä¸å¯ç”¨ã€‚

## åˆ†æè¿‡ç¨‹

### 1. ç°è±¡è§‚å¯Ÿ
```
ç—‡çŠ¶: HTTP 500é”™è¯¯æ¿€å¢
æŒ‡æ ‡å¼‚å¸¸: 
- æ•°æ®åº“è¿æ¥æ•°: 5/5 (100%ä½¿ç”¨ç‡)
- åº”ç”¨å“åº”æ—¶é—´: ä»50msé£™å‡è‡³5000ms+
- é”™è¯¯ç‡: ä»0.1%ä¸Šå‡è‡³95%
```

### 2. å‡è®¾éªŒè¯
```
å‡è®¾1: æ•°æ®åº“æœåŠ¡å™¨æ•…éšœ
éªŒè¯: æ•°æ®åº“ç›‘æ§æ˜¾ç¤ºæ­£å¸¸ï¼Œæ’é™¤ âœ“

å‡è®¾2: ç½‘ç»œè¿æ¥é—®é¢˜
éªŒè¯: ç½‘ç»œè¿é€šæ€§æµ‹è¯•æ­£å¸¸ï¼Œæ’é™¤ âœ“

å‡è®¾3: åº”ç”¨ç¨‹åºBug
éªŒè¯: ä»£ç å®¡æŸ¥æœªå‘ç°é—®é¢˜ï¼Œæ’é™¤ âœ“

å‡è®¾4: é…ç½®é”™è¯¯
éªŒè¯: å‘ç°è¿æ¥æ± é…ç½®è¢«ä¿®æ”¹ï¼Œç¡®è®¤ âœ“
```

### 3. æ ¹å› è¿½æº¯
```
é…ç½®å˜æ›´è®°å½•è¿½è¸ª:
- 2026-02-05 14:00: é…ç½®ä»20æ”¹ä¸º5
- å˜æ›´äºº: æå›› (DevOps Engineer)
- å˜æ›´ç†ç”±: "ä¼˜åŒ–èµ„æºä½¿ç”¨"
- å®¡æ‰¹çŠ¶æ€: æœªç»å®¡æ‰¹ âŒ
```

## æ ¹å› ç»“è®º

**ä¸»è¦æ ¹å› **: é…ç½®ç®¡ç†æµç¨‹ç¼ºå¤±å¯¼è‡´çš„æœªæˆæƒé…ç½®å˜æ›´

**æ¬¡è¦æ ¹å› **: 
1. ç¼ºä¹é…ç½®å˜æ›´çš„è‡ªåŠ¨åŒ–éªŒè¯
2. ç›‘æ§å‘Šè­¦é˜ˆå€¼è®¾ç½®ä¸åˆç†
3. å˜æ›´æ—¶æœºé€‰æ‹©ä¸å½“

## è§£å†³æ–¹æ¡ˆ

### æŠ€æœ¯æªæ–½
1. å®æ–½é…ç½®å˜æ›´å®¡æ‰¹æµç¨‹
2. å¢åŠ é…ç½®éªŒè¯è‡ªåŠ¨åŒ–æµ‹è¯•
3. ä¼˜åŒ–ç›‘æ§å‘Šè­¦ç­–ç•¥

### æµç¨‹æªæ–½
1. å»ºç«‹å˜æ›´ç®¡ç†å§”å‘˜ä¼š
2. åˆ¶å®šå˜æ›´çª—å£ç®¡ç†è§„èŒƒ
3. å®Œå–„åº”æ€¥é¢„æ¡ˆ

### ç»„ç»‡æªæ–½
1. åŠ å¼ºå›¢é˜ŸåŸ¹è®­
2. å»ºç«‹è´£ä»»è¿½ç©¶æœºåˆ¶
3. å®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ

## é¢„é˜²æªæ–½

### è‡ªåŠ¨åŒ–é˜²æŠ¤
```yaml
# é…ç½®å˜æ›´ä¿æŠ¤ç­–ç•¥
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: config-change-validator
webhooks:
- name: config-change-validator.example.com
  clientConfig:
    service:
      name: config-validator
      namespace: kube-system
  rules:
  - operations: ["UPDATE"]
    apiGroups: [""]
    apiVersions: ["v1"]
    resources: ["configmaps", "secrets"]
  admissionReviewVersions: ["v1"]
  sideEffects: None
  timeoutSeconds: 5
```

### ç›‘æ§å¢å¼º
```yaml
# é…ç½®æ¼‚ç§»æ£€æµ‹
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: config-drift-detection
spec:
  groups:
  - name: config.drift.rules
    rules:
    - alert: ConfigDriftDetected
      expr: |
        changes(config_hash{type="database-pool"}[5m]) > 0
        and
        config_approval_status != "approved"
      for: 1m
      labels:
        severity: critical
      annotations:
        summary: "æ£€æµ‹åˆ°æœªæˆæƒçš„é…ç½®å˜æ›´"
```
```

---

## 6. é¢„é˜²æªæ–½ä½“ç³»

### 6.1 æ•…éšœé¢„é˜²é‡‘å­—å¡”

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ™ºèƒ½é¢„æµ‹é¢„è­¦      â”‚  â† æœ€ä½³çŠ¶æ€
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ä¸»åŠ¨å¥åº·æ£€æŸ¥      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   è‡ªåŠ¨åŒ–ä¿®å¤        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å¿«é€Ÿæ•…éšœå®šä½      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å®Œå–„ç›‘æ§å‘Šè­¦      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   åŸºç¡€é…ç½®ç®¡ç†      â”‚  â† æœ€ä½è¦æ±‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 é¢„é˜²æ€§æ£€æŸ¥æ¸…å•

#### æ—¥å¸¸è¿ç»´æ£€æŸ¥
- [ ] é›†ç¾¤ç»„ä»¶å¥åº·çŠ¶æ€æ£€æŸ¥
- [ ] å…³é”®æœåŠ¡SLI/SLOè¾¾æ ‡æƒ…å†µ
- [ ] èµ„æºä½¿ç”¨ç‡è¶‹åŠ¿åˆ†æ
- [ ] é…ç½®å˜æ›´å®¡è®¡æ—¥å¿—å®¡æŸ¥
- [ ] å®‰å…¨æ¼æ´æ‰«æç»“æœ

#### å‘¨æœŸæ€§è¯„ä¼°
- [ ] ç¾å¤‡æ¼”ç»ƒæ‰§è¡Œæƒ…å†µ
- [ ] ç›‘æ§å‘Šè­¦æœ‰æ•ˆæ€§éªŒè¯
- [ ] è‡ªåŠ¨åŒ–æµç¨‹è¿è¡ŒçŠ¶æ€
- [ ] å›¢é˜ŸæŠ€èƒ½æ°´å¹³è¯„ä¼°
- [ ] ç¬¬ä¸‰æ–¹æœåŠ¡ä¾èµ–å¥åº·åº¦

#### å­£åº¦æ€§å®¡æŸ¥
- [ ] æ¶æ„è®¾è®¡åˆç†æ€§è¯„ä¼°
- [ ] æŠ€æœ¯å€ºåŠ¡æ¸…ç†è¿›åº¦
- [ ] æˆæœ¬æ•ˆç›Šåˆ†æ
- [ ] åˆè§„æ€§è¦æ±‚æ»¡è¶³åº¦
- [ ] è¡Œä¸šæœ€ä½³å®è·µå¯¹æ ‡

### 6.3 æŒç»­æ”¹è¿›æœºåˆ¶

```yaml
# ========== æŒç»­æ”¹è¿›æµç¨‹é…ç½® ==========
apiVersion: improvement.example.com/v1
kind: ContinuousImprovementProcess
metadata:
  name: k8s-operations-improvement
spec:
  # æ”¹è¿›å‘¨æœŸè®¾ç½®
  cadence:
    incidentReview: "post-incident"    # äº‹åå¤ç›˜
    monthlyReview: "monthly"           # æœˆåº¦è¯„å®¡
    quarterlyAssessment: "quarterly"   # å­£åº¦è¯„ä¼°
    
  # æ”¹è¿›æŒ‡æ ‡
  metrics:
  - name: meanTimeToRecovery
    target: "< 15m"
    current: "22m"
    trend: "decreasing"
    
  - name: incidentFrequency
    target: "< 2æ¬¡/æœˆ"
    current: "4æ¬¡/æœˆ"
    trend: "decreasing"
    
  - name: automationCoverage
    target: "> 80%"
    current: "65%"
    trend: "increasing"
    
  # æ”¹è¿›è¡ŒåŠ¨è®¡åˆ’
  actionItems:
  - id: "AI-202602-001"
    description: "å»ºç«‹é…ç½®å˜æ›´å®¡æ‰¹æµç¨‹"
    owner: "sre-team"
    dueDate: "2026-02-28"
    status: "in-progress"
    
  - id: "AI-202602-002"
    description: "ä¼˜åŒ–ç›‘æ§å‘Šè­¦ç­–ç•¥"
    owner: "monitoring-team"
    dueDate: "2026-03-15"
    status: "planned"
    
  # çŸ¥è¯†æ²‰æ·€æœºåˆ¶
  knowledgeManagement:
    incidentRepository: "https://wiki.example.com/incidents"
    runbookUpdates: "weekly"
    trainingMaterials: "quarterly"
```

---
## 7. çœŸå®æ•…éšœæ¡ˆä¾‹åº“

### 7.1 ç»å…¸æ•…éšœæ¡ˆä¾‹é›†é”¦

#### æ¡ˆä¾‹1: etcdè„‘è£‚å¯¼è‡´é›†ç¾¤ç˜«ç—ª
```markdown
**æ•…éšœèƒŒæ™¯**: 
æŸé‡‘èå…¬å¸ç”Ÿäº§ç¯å¢ƒKubernetesé›†ç¾¤çªç„¶æ— æ³•è°ƒåº¦æ–°Podï¼Œå·²æœ‰æœåŠ¡è¿è¡Œæ­£å¸¸ä½†æ— æ³•æ›´æ–°

**æ•…éšœæ—¶é—´çº¿**:
- 14:23: ç›‘æ§å‘Šè­¦æ˜¾ç¤ºetcd leaderåˆ‡æ¢é¢‘ç¹
- 14:25: kubectlå‘½ä»¤å¼€å§‹å‡ºç°è¶…æ—¶
- 14:30: æ–°Podåˆ›å»ºå®Œå…¨å¤±è´¥
- 14:35: ç¡®è®¤etcdé›†ç¾¤å‡ºç°è„‘è£‚

**è¯Šæ–­è¿‡ç¨‹**:
```bash
# æ£€æŸ¥etcdé›†ç¾¤çŠ¶æ€
kubectl exec -n kube-system etcd-master1 -- etcdctl endpoint health
# è¾“å‡ºæ˜¾ç¤ºä¸¤ä¸ªèŠ‚ç‚¹healthyï¼Œä¸€ä¸ªunhealthy

# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping etcd-master2
# å‘ç°ç½‘ç»œå»¶è¿Ÿå¼‚å¸¸é«˜(>1000ms)

# æ£€æŸ¥etcdæˆå‘˜çŠ¶æ€
kubectl exec -n kube-system etcd-master1 -- etcdctl member list
# å‘ç°ä¸‰ä¸ªæˆå‘˜ä½†åªæœ‰ä¸¤ä¸ªå“åº”
```

**æ ¹æœ¬åŸå› **: 
æ•°æ®ä¸­å¿ƒç½‘ç»œè®¾å¤‡å›ºä»¶bugå¯¼è‡´ç½‘ç»œåˆ†åŒºï¼Œetcdé›†ç¾¤åˆ†è£‚ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„quorum

**è§£å†³æ–¹æ¡ˆ**:
1. ç«‹å³éš”ç¦»æ•…éšœç½‘ç»œè®¾å¤‡
2. æ‰‹åŠ¨ç§»é™¤ä¸å¥åº·çš„etcdæˆå‘˜
3. æ¢å¤ç½‘ç»œè¿é€šæ€§
4. é‡æ–°æ·»åŠ etcdæˆå‘˜å¹¶åŒæ­¥æ•°æ®

**é¢„é˜²æªæ–½**:
- éƒ¨ç½²ç½‘ç»œè®¾å¤‡ç›‘æ§
- å¢åŠ etcdå¥åº·æ£€æŸ¥é¢‘ç‡
- å»ºç«‹å¤šåœ°åŸŸetcdé›†ç¾¤æ¶æ„
```

#### æ¡ˆä¾‹2: èµ„æºé…é¢é…ç½®é”™è¯¯å¼•å‘è¿é”æ•…éšœ
```markdown
**æ•…éšœèƒŒæ™¯**: 
ç”µå•†å¹³å°ä¿ƒé”€æœŸé—´ï¼Œè®¢å•æœåŠ¡çªç„¶å¤§é¢ç§¯500é”™è¯¯ï¼Œå½±å“ç”¨æˆ·ä¸‹å•

**æ•…éšœæ—¶é—´çº¿**:
- 09:58: ä¿ƒé”€æ´»åŠ¨å¼€å§‹
- 10:02: è®¢å•æœåŠ¡å“åº”æ—¶é—´æ€¥å‰§ä¸Šå‡
- 10:05: å¤§é‡Podè¿›å…¥OOMKilledçŠ¶æ€
- 10:08: æœåŠ¡å®Œå…¨ä¸å¯ç”¨

**è¯Šæ–­è¿‡ç¨‹**:
```bash
# æ£€æŸ¥PodçŠ¶æ€
kubectl get pods -n order-system | grep OOM
# å‘ç°30+ä¸ªPodå› OOMè¢«ç»ˆæ­¢

# æ£€æŸ¥èµ„æºä½¿ç”¨æƒ…å†µ
kubectl top pods -n order-system
# æ˜¾ç¤ºå†…å­˜ä½¿ç”¨æ¥è¿‘limitå€¼

# æ£€æŸ¥ResourceQuotaé…ç½®
kubectl describe resourcequota -n order-system
# å‘ç°é…é¢è®¾ç½®è¿‡äºä¸¥æ ¼ï¼Œé™åˆ¶äº†æ°´å¹³æ‰©ç¼©å®¹

# æ£€æŸ¥HPAé…ç½®
kubectl describe hpa -n order-system
# HPAå› èµ„æºä¸è¶³æ— æ³•åˆ›å»ºæ–°å‰¯æœ¬
```

**æ ¹æœ¬åŸå› **: 
ResourceQuotaé…ç½®è¿‡äºä¿å®ˆï¼Œåœ¨æµé‡æ¿€å¢æ—¶é™åˆ¶äº†å¿…è¦çš„èµ„æºæ‰©å±•

**è§£å†³æ–¹æ¡ˆ**:
1. ä¸´æ—¶åˆ é™¤ResourceQuotaé™åˆ¶
2. ç´§æ€¥æ‰©å®¹Podå‰¯æœ¬æ•°
3. è°ƒæ•´HPAé…ç½®å‚æ•°
4. ä¼˜åŒ–åº”ç”¨å†…å­˜ä½¿ç”¨

**é¢„é˜²æªæ–½**:
- å»ºç«‹å¼¹æ€§èµ„æºé…ç½®ç­–ç•¥
- å®æ–½æ¸è¿›å¼æµé‡æ”¾é‡
- å®Œå–„å®¹é‡è§„åˆ’æµç¨‹
- å¢åŠ å‹åŠ›æµ‹è¯•é¢‘æ¬¡
```

#### æ¡ˆä¾‹3: ç½‘ç»œç­–ç•¥é…ç½®å¤±è¯¯é˜»æ–­æœåŠ¡é€šä¿¡
```markdown
**æ•…éšœèƒŒæ™¯**: 
å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œç”¨æˆ·æœåŠ¡æ— æ³•è°ƒç”¨æ”¯ä»˜æœåŠ¡ï¼Œå¯¼è‡´äº¤æ˜“æµç¨‹ä¸­æ–­

**æ•…éšœæ—¶é—´çº¿**:
- 16:15: è¿ç»´å›¢é˜Ÿæ›´æ–°NetworkPolicyç­–ç•¥
- 16:17: ç›‘æ§æ˜¾ç¤ºæ”¯ä»˜æœåŠ¡è°ƒç”¨å¤±è´¥ç‡é£™å‡
- 16:20: ç”¨æˆ·åé¦ˆæ— æ³•å®Œæˆæ”¯ä»˜
- 16:25: ç¡®è®¤æ˜¯ç½‘ç»œç­–ç•¥é…ç½®é—®é¢˜

**è¯Šæ–­è¿‡ç¨‹**:
```bash
# æµ‹è¯•æœåŠ¡è¿é€šæ€§
kubectl exec -it user-service-pod -- curl -v http://payment-service:8080/health
# è¿”å›Connection refused

# æ£€æŸ¥NetworkPolicyé…ç½®
kubectl get networkpolicy -n production
# å‘ç°æ–°æ·»åŠ çš„ç­–ç•¥è¿‡äºä¸¥æ ¼

# éªŒè¯æ ‡ç­¾åŒ¹é…
kubectl get pods --show-labels -n production | grep payment
# æ ‡ç­¾é€‰æ‹©å™¨é…ç½®é”™è¯¯

# æµ‹è¯•ç­–ç•¥æ•ˆæœ
kubectl describe networkpolicy restrictive-policy -n production
# ç­–ç•¥é˜»æ­¢äº†å¿…è¦çš„æœåŠ¡é—´é€šä¿¡
```

**æ ¹æœ¬åŸå› **: 
NetworkPolicyæ›´æ–°æ—¶æ ‡ç­¾é€‰æ‹©å™¨é…ç½®é”™è¯¯ï¼Œæ„å¤–é˜»æ–­äº†åˆæ³•çš„æœåŠ¡é—´é€šä¿¡

**è§£å†³æ–¹æ¡ˆ**:
1. ç«‹å³å›æ»šNetworkPolicyå˜æ›´
2. ä¿®æ­£æ ‡ç­¾é€‰æ‹©å™¨é…ç½®
3. å®æ–½æ¸è¿›å¼ç­–ç•¥éƒ¨ç½²
4. åŠ å¼ºå˜æ›´å‰æµ‹è¯•éªŒè¯

**é¢„é˜²æªæ–½**:
- å»ºç«‹ç½‘ç»œç­–ç•¥å˜æ›´å®¡æ‰¹æµç¨‹
- å®æ–½canaryéƒ¨ç½²ç­–ç•¥
- å¢åŠ æœåŠ¡è¿é€šæ€§ç›‘æ§
- å®Œå–„å˜æ›´ç®¡ç†è§„èŒƒ
```

### 7.2 æ•…éšœå¤„ç†ç»éªŒæ€»ç»“

#### å¸¸è§è¯Šæ–­è¯¯åŒºåŠé¿å…æ–¹æ³•

| è¯¯åŒº | æ­£ç¡®åšæ³• | ç»éªŒæ•™è®­ |
|------|----------|----------|
| **æ€¥äºé‡å¯æœåŠ¡** | å…ˆå®Œæ•´è¯Šæ–­å†è¡ŒåŠ¨ | é‡å¯å¯èƒ½æ©ç›–çœŸæ­£é—®é¢˜ |
| **å¿½è§†ç›‘æ§å‘Šè­¦** | å»ºç«‹å‘Šè­¦åˆ†çº§å“åº”æœºåˆ¶ | å°é—®é¢˜å¯èƒ½æ¼”å˜æˆå¤§æ•…éšœ |
| **å•ç‹¬å¤„ç†é—®é¢˜** | å›¢é˜Ÿåä½œå…±åŒè¯Šæ–­ | å¤æ‚æ•…éšœéœ€è¦å¤šæ–¹ expertise |
| **å¿½ç•¥å˜æ›´å†å²** | å»ºç«‹å®Œæ•´çš„å˜æ›´æ—¥å¿— | 90%çš„æ•…éšœæºäºå˜æ›´ |
| **ç¼ºä¹å›æ»šé¢„æ¡ˆ** | åˆ¶å®šè¯¦ç»†çš„å›æ»šè®¡åˆ’ | å¿«é€Ÿå›æ»šèƒ½å¤§å¹…ç¼©çŸ­MTTR |

#### æ•…éšœå¤„ç†é»„é‡‘æ³•åˆ™

1. **ä¿æŒå†·é™**: æ•…éšœå¤„ç†çš„ç¬¬ä¸€è¦åŠ¡æ˜¯ä¿æŒå¤´è„‘æ¸…é†’
2. **å¿«é€Ÿç¡®è®¤**: 5åˆ†é’Ÿå†…ç¡®è®¤æ•…éšœå½±å“èŒƒå›´å’Œä¸¥é‡ç¨‹åº¦
3. **åŠæ—¶æ²Ÿé€š**: ç«‹å³é€šçŸ¥ç›¸å…³æ–¹ï¼Œé¿å…ä¿¡æ¯ä¸å¯¹ç§°
4. **è®°å½•å®Œæ•´**: è¯¦ç»†è®°å½•æ•…éšœå¤„ç†å…¨è¿‡ç¨‹
5. **å½»åº•å¤ç›˜**: æ•…éšœè§£å†³åå¿…é¡»è¿›è¡Œæ·±åº¦å¤ç›˜

#### é¢„é˜²æ€§è¿ç»´å»ºè®®

- **ç›‘æ§å…¨è¦†ç›–**: ç¡®ä¿å…³é”®æŒ‡æ ‡éƒ½æœ‰ç›‘æ§è¦†ç›–
- **å‘Šè­¦ç²¾å‡†åŒ–**: é¿å…å‘Šè­¦é£æš´ï¼Œæé«˜ä¿¡å™ªæ¯”
- **è‡ªåŠ¨åŒ–æµ‹è¯•**: å»ºç«‹å®Œå–„çš„è‡ªåŠ¨åŒ–æµ‹è¯•ä½“ç³»
- **å®¹é‡è§„åˆ’**: å®šæœŸè¿›è¡Œå®¹é‡è¯„ä¼°å’Œè§„åˆ’
- **çŸ¥è¯†æ²‰æ·€**: å»ºç«‹æ•…éšœæ¡ˆä¾‹çŸ¥è¯†åº“

---

## 8. é«˜çº§æ•…éšœè¯Šæ–­æŠ€æœ¯

### 8.1 åˆ†å¸ƒå¼ç³»ç»Ÿæ•…éšœå®šä½æ–¹æ³•è®º

#### åˆ†å±‚è¯Šæ–­æ¡†æ¶
```mermaid
graph TB
    A[ç”¨æˆ·æŠ¥å‘Šé—®é¢˜] --> B{é—®é¢˜åˆ†ç±»}
    B --> C[æ€§èƒ½é—®é¢˜]
    B --> D[å¯ç”¨æ€§é—®é¢˜]
    B --> E[æ•°æ®é—®é¢˜]
    
    C --> F[åº”ç”¨å±‚è¯Šæ–­]
    C --> G[ä¸­é—´ä»¶å±‚è¯Šæ–­]
    C --> H[åŸºç¡€è®¾æ–½å±‚è¯Šæ–­]
    
    D --> I[æœåŠ¡çŠ¶æ€æ£€æŸ¥]
    D --> J[ç½‘ç»œè¿é€šæ€§]
    D --> K[ä¾èµ–æœåŠ¡å¥åº·]
    
    E --> L[æ•°æ®ä¸€è‡´æ€§]
    E --> M[å­˜å‚¨ç³»ç»Ÿ]
    E --> N[ç¼“å­˜å±‚]
    
    F --> O[åº”ç”¨æ—¥å¿—åˆ†æ]
    G --> P[ä¸­é—´ä»¶ç›‘æ§]
    H --> Q[ç³»ç»Ÿèµ„æº]
    
    style A fill:#e3f2fd
    style B fill:#f3e5f5
    style F fill:#e8f5e8
```

#### æ•…éšœä¼ æ’­è·¯å¾„åˆ†æ
| ä¼ æ’­ç±»å‹ | ç‰¹å¾è¡¨ç° | è¯Šæ–­è¦ç‚¹ | é˜»æ–­ç­–ç•¥ |
|----------|----------|----------|----------|
| **å‚ç›´ä¼ æ’­** | ä»åº•å±‚å‘ä¸Šå±‚é€çº§å½±å“ | ä»åŸºç¡€è®¾æ–½å¼€å§‹æ’æŸ¥ | éš”ç¦»æ•…éšœèŠ‚ç‚¹ |
| **æ°´å¹³ä¼ æ’­** | åŒå±‚ç»„ä»¶é—´ç›¸äº’å½±å“ | åˆ†æä¾èµ–å…³ç³»å›¾ | æ–­å¼€ç¯å½¢ä¾èµ– |
| **è·¨å±‚ä¼ æ’­** | è·¨è¶Šå¤šä¸ªæŠ½è±¡å±‚å½±å“ | å»ºç«‹ç«¯åˆ°ç«¯è¿½è¸ª | å®æ–½ç†”æ–­æœºåˆ¶ |
| **è¿é”ååº”** | ä¸€ä¸ªå°æ•…éšœå¼•å‘é›ªå´©æ•ˆåº” | ç›‘æ§å…³é”®æŒ‡æ ‡é˜ˆå€¼ | è®¾ç½®é™çº§é¢„æ¡ˆ |

### 8.2 æ™ºèƒ½åŒ–æ•…éšœé¢„æµ‹ä¸è‡ªæ„ˆ

#### å¼‚å¸¸æ£€æµ‹ç®—æ³•çŸ©é˜µ
| ç®—æ³•ç±»å‹ | é€‚ç”¨åœºæ™¯ | æ£€æµ‹ç²¾åº¦ | è®¡ç®—å¤æ‚åº¦ | å®æ–½å»ºè®® |
|----------|----------|----------|------------|----------|
| **ç»Ÿè®¡å­¦æ–¹æ³•** | ç¨³å®šç³»ç»Ÿçš„å¼‚å¸¸æ³¢åŠ¨ | é«˜ | ä½ | é€‚åˆåŸºç¡€ç›‘æ§ |
| **æœºå™¨å­¦ä¹ ** | å¤æ‚æ¨¡å¼è¯†åˆ« | å¾ˆé«˜ | ä¸­ç­‰ | éœ€è¦å†å²æ•°æ®è®­ç»ƒ |
| **æ·±åº¦å­¦ä¹ ** | å¤šç»´æ—¶åºå¼‚å¸¸ | æœ€é«˜ | é«˜ | å¤§è§„æ¨¡ç³»ç»Ÿæ¨è |
| **è§„åˆ™å¼•æ“** | å·²çŸ¥æ•…éšœæ¨¡å¼ | ä¸­ç­‰ | ä½ | å¿«é€Ÿå®æ–½é¦–é€‰ |

#### è‡ªæ„ˆç³»ç»Ÿæ¶æ„è®¾è®¡
```yaml
# ========== æ™ºèƒ½è‡ªæ„ˆç³»ç»Ÿé…ç½® ==========
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: intelligent-healing-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: critical-service
  minReplicas: 3
  maxReplicas: 30
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 10
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Pods
        value: 4
        periodSeconds: 60
      - type: Percent
        value: 100
        periodSeconds: 60

---
# ========== æ•…éšœé¢„æµ‹å‘Šè­¦è§„åˆ™ ==========
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: predictive-alerting
spec:
  groups:
  - name: predictive.rules
    rules:
    - alert: PredictedHighErrorRate
      expr: predict_linear(application_error_rate[1h], 4 * 3600) > 0.05
      for: 10m
      labels:
        severity: warning
      annotations:
        summary: "é¢„æµ‹æœªæ¥4å°æ—¶é”™è¯¯ç‡å°†è¶…è¿‡5%"
        description: "åŸºäºè¿‡å»1å°æ—¶è¶‹åŠ¿é¢„æµ‹ï¼Œå»ºè®®æå‰æ‰©å®¹"
        
    - alert: AnomalyDetectionCPU
      expr: histogram_quantile(0.95, rate(container_cpu_usage_seconds_total[5m])) > 
            (avg_over_time(histogram_quantile(0.95, rate(container_cpu_usage_seconds_total[5m]))[1h:]) * 1.5)
      for: 5m
      labels:
        severity: critical
      annotations:
        summary: "CPUä½¿ç”¨å‡ºç°å¼‚å¸¸å³°å€¼"
        description: "å½“å‰CPUä½¿ç”¨è¶…å‡ºå†å²å¹³å‡æ°´å¹³50%ï¼Œå¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜"
```

### 8.3 æ•…éšœæ¼”ç»ƒä¸æ··æ²Œå·¥ç¨‹

#### ç”Ÿäº§ç¯å¢ƒæ•…éšœæ¼”ç»ƒæ¡†æ¶
| æ¼”ç»ƒç±»å‹ | ç›®æ ‡ | é£é™©ç­‰çº§ | å®æ–½é¢‘ç‡ | è¯„ä¼°æŒ‡æ ‡ |
|----------|------|----------|----------|----------|
| **ç½‘ç»œåˆ†åŒº** | éªŒè¯æœåŠ¡å®¹é”™èƒ½åŠ› | é«˜ | å­£åº¦ | MTTRã€æ•°æ®ä¸€è‡´æ€§ |
| **èŠ‚ç‚¹æ•…éšœ** | æµ‹è¯•è‡ªåŠ¨æ¢å¤æœºåˆ¶ | ä¸­ | æœˆåº¦ | æ¢å¤æ—¶é—´ã€æ•°æ®ä¸¢å¤± |
| **å­˜å‚¨æ•…éšœ** | éªŒè¯æ•°æ®ä¿æŠ¤ç­–ç•¥ | é«˜ | åŠå¹´ | RTOã€RPOè¾¾æˆç‡ |
| **APIé™æµ** | æ£€æŸ¥é™çº§å¤„ç†èƒ½åŠ› | ä½ | æœˆåº¦ | ç”¨æˆ·ä½“éªŒå½±å“åº¦ |
| **å®‰å…¨æ”»å‡»** | éªŒè¯å®‰å…¨é˜²æŠ¤ä½“ç³» | ä¸­ | å­£åº¦ | å¨èƒæ£€æµ‹å‡†ç¡®ç‡ |

#### Chaos Engineeringæœ€ä½³å®è·µ
```bash
#!/bin/bash
# ========== æ··æ²Œå·¥ç¨‹å®éªŒè„šæœ¬ ==========
set -euo pipefail

# å®éªŒé…ç½®
EXPERIMENT_NAME="pod-kill-test"
NAMESPACE="production"
TARGET_DEPLOYMENT="user-service"
DURATION="5m"
INTERVAL="10s"

echo "ğŸš€ å¼€å§‹æ··æ²Œå·¥ç¨‹å®éªŒ: ${EXPERIMENT_NAME}"

# 1. é¢„æ£€å‡†å¤‡
echo "ğŸ“‹ æ‰§è¡Œé¢„æ£€æ£€æŸ¥..."
kubectl get deployment ${TARGET_DEPLOYMENT} -n ${NAMESPACE} || {
    echo "âŒ ç›®æ ‡éƒ¨ç½²ä¸å­˜åœ¨"
    exit 1
}

# 2. å»ºç«‹åŸºçº¿ç›‘æ§
echo "ğŸ“Š å»ºç«‹åŸºçº¿ç›‘æ§..."
BASELINE_METRICS=$(kubectl get --raw="/apis/metrics.k8s.io/v1beta1/namespaces/${NAMESPACE}/pods" | \
    jq '.items[] | select(.metadata.name | startswith("'${TARGET_DEPLOYMENT}'")) | .containers[].usage.cpu')

# 3. æ‰§è¡Œæ•…éšœæ³¨å…¥
echo "ğŸ’¥ æ³¨å…¥æ•…éšœ..."
litmusctl create experiment \
    --name=${EXPERIMENT_NAME} \
    --namespace=${NAMESPACE} \
    --target-deployment=${TARGET_DEPLOYMENT} \
    --duration=${DURATION} \
    --interval=${INTERVAL} \
    --chaos-type=pod-delete

# 4. å®æ—¶ç›‘æ§å½±å“
echo "ğŸ” ç›‘æ§å®éªŒå½±å“..."
watch -n 5 "kubectl get pods -n ${NAMESPACE} -l app=${TARGET_DEPLOYMENT} -o wide"

# 5. æ”¶é›†å®éªŒæ•°æ®
echo "ğŸ“ æ”¶é›†å®éªŒæ•°æ®..."
END_METRICS=$(kubectl get --raw="/apis/metrics.k8s.io/v1beta1/namespaces/${NAMESPACE}/pods" | \
    jq '.items[] | select(.metadata.name | startswith("'${TARGET_DEPLOYMENT}'")) | .containers[].usage.cpu')

# 6. ç”Ÿæˆå®éªŒæŠ¥å‘Š
cat > chaos-report-${EXPERIMENT_NAME}.md << EOF
# æ··æ²Œå·¥ç¨‹å®éªŒæŠ¥å‘Š: ${EXPERIMENT_NAME}

## å®éªŒæ¦‚è¦
- **æ—¶é—´**: $(date)
- **ç›®æ ‡**: ${TARGET_DEPLOYMENT}
- **æŒç»­æ—¶é—´**: ${DURATION}
- **æ•…éšœç±»å‹**: Podåˆ é™¤

## å…³é”®æŒ‡æ ‡å˜åŒ–
- åŸºçº¿CPUä½¿ç”¨: ${BASELINE_METRICS}
- æ•…éšœæœŸé—´CPUä½¿ç”¨: ${END_METRICS}
- æ¢å¤æ—¶é—´: TODO

## ç»“è®ºä¸å»ºè®®
TODO: æ ¹æ®å®éªŒç»“æœå¡«å†™
EOF

echo "âœ… æ··æ²Œå·¥ç¨‹å®éªŒå®Œæˆ"
```

---

**è¡¨æ ¼åº•éƒ¨æ ‡è®°**: Kusheet Project | ä½œè€…: Allen Galler (allengaller@gmail.com) | æœ€åæ›´æ–°: 2026-02 | ç‰ˆæœ¬: v1.25-v1.32 | è´¨é‡ç­‰çº§: â­â­â­â­â­ ä¸“å®¶çº§