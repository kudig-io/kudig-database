# Kubernetes 调度与编排策略全栈培训

> **适用版本**: Kubernetes v1.28 - v1.32 | **文档类型**: 性能与稳定性专项
> **目标受众**: 架构师、SRE、应用运维
> **核心原则**: 资源利用率最大化、业务高可用分布、调度公平性

---

## 🔰 第一阶段：调度基础

### 1.1 调度器做了什么？
*   **目的**: 将待调度的 Pod 分配到一个最合适的 Node 上。
*   **流程**: 
    1.  **过滤 (Filtering)**: 排除不符合条件的 Node（如资源不足、端口冲突）。
    2.  **打分 (Scoring)**: 在剩下的 Node 中选出最优解（如镜像已存在、资源更空闲）。

### 1.2 基础干预手段
*   **nodeSelector**: 简单的标签匹配（“去 SSD 节点”）。
*   **resource requests**: 告诉调度器我需要多少资源。

---

## 📘 第二阶段：高级调度策略 (Expert Focus)

### 2.1 亲和性与反亲和性
*   **NodeAffinity**: 比 nodeSelector 更灵活的逻辑（In, NotIn, Exists）。
*   **PodAffinity/AntiAffinity**: 基于 Pod 之间的关系调度（“跟缓存 Pod 放在一起” 或 “不要跟同一个应用的 Pod 在一起”）。

### 2.2 污点与容忍 (Taints & Tolerations)
*   **Taint**: Node 拒绝 Pod 进来（“我有病，别来”）。
*   **Toleration**: Pod 声明可以接受污点（“我不怕你的病”）。
*   **典型场景**: 专用节点、Master 节点保护。

---

## ⚡ 第三阶段：生产级稳定性保障

### 3.1 驱逐与重调度
*   **Node 压力驱逐**: 当 Node 内存/磁盘耗尽时，kubelet 会主动杀掉低优先级 Pod。
*   **Descheduler (重调度器)**: 解决集群长时间运行后的负载不均问题。

### 3.2 优先级与抢占
*   **PriorityClass**: 定义 Pod 优先级。高优先级 Pod 可以在资源不足时“抢占”低优先级 Pod 的坑位。

---

## 🛠️ 第四阶段：性能调优与巡检

### 🏆 SRE 运维红线
*   *红线 1: 生产环境必须配置反亲和性，防止单点故障。*
*   *红线 2: 严禁滥用 `nodeName` 绕过调度器。*
*   *红线 3: 必须监控集群整体分配率 (Allocated) 与实际使用率 (Usage) 的差值。*
