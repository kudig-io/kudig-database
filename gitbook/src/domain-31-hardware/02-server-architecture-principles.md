# 服务器架构原理

## 概述

服务器是数据中心的核心计算单元，其架构设计直接影响整体性能、可靠性和扩展性。本文档深入解析服务器硬件架构的核心原理，涵盖处理器架构、内存子系统、I/O子系统及系统总线等关键技术。

## 服务器系统架构演进

### 架构发展历程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        服务器架构演进历程                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1990s          2000s          2010s          2020s          未来           │
│    │              │              │              │              │            │
│    ▼              ▼              ▼              ▼              ▼            │
│  ┌────┐        ┌────┐        ┌────┐        ┌────┐        ┌────┐           │
│  │FSB │───────→│QPI │───────→│QPI2│───────→│UPI │───────→│CXL │           │
│  │架构│        │架构│        │/UPI│        │2.0 │        │架构│           │
│  └────┘        └────┘        └────┘        └────┘        └────┘           │
│                                                                             │
│  前端总线      点对点        集成内存     高速互联      内存池化           │
│  北桥芯片      QuickPath    控制器      加速器支持    异构计算             │
│  共享带宽      Intel直连    NUMA优化    PCIe Gen4    CXL互联              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 现代服务器架构概览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     现代双路服务器架构图                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌────────────────────────────┐    ┌────────────────────────────┐          │
│  │        Socket 0            │    │        Socket 1            │          │
│  │  ┌──────────────────────┐  │    │  ┌──────────────────────┐  │          │
│  │  │       CPU 0          │  │    │  │       CPU 1          │  │          │
│  │  │  ┌────┬────┬────┐   │  │    │  │  ┌────┬────┬────┐   │  │          │
│  │  │  │Core│Core│Core│   │  │    │  │  │Core│Core│Core│   │  │          │
│  │  │  │ 0  │ 1  │ 2  │...│  │    │  │  │ 0  │ 1  │ 2  │...│  │          │
│  │  │  └────┴────┴────┘   │  │    │  │  └────┴────┴────┘   │  │          │
│  │  │  ┌────────────────┐  │  │    │  │  ┌────────────────┐  │  │          │
│  │  │  │   L3 Cache     │  │  │    │  │  │   L3 Cache     │  │  │          │
│  │  │  │   (共享)       │  │  │    │  │  │   (共享)       │  │  │          │
│  │  │  └────────────────┘  │  │    │  │  └────────────────┘  │  │          │
│  │  │  ┌────────────────┐  │  │    │  │  ┌────────────────┐  │  │          │
│  │  │  │ 内存控制器     │  │  │◄═══════►│ 内存控制器     │  │  │          │
│  │  │  │ (IMC)         │  │  │  UPI    │  │ (IMC)         │  │  │          │
│  │  │  └───────┬────────┘  │  │         │  └───────┬────────┘  │  │          │
│  │  └──────────┼───────────┘  │         │  └──────────┼───────────┘  │          │
│  │             │              │         │             │              │          │
│  │       ┌─────┴─────┐        │         │       ┌─────┴─────┐        │          │
│  │       ▼           ▼        │         │       ▼           ▼        │          │
│  │  ┌────────┐ ┌────────┐    │         │  ┌────────┐ ┌────────┐    │          │
│  │  │ DIMM   │ │ DIMM   │    │         │  │ DIMM   │ │ DIMM   │    │          │
│  │  │ 通道0  │ │ 通道1  │... │         │  │ 通道0  │ │ 通道1  │... │          │
│  │  └────────┘ └────────┘    │         │  └────────┘ └────────┘    │          │
│  └────────────────────────────┘         └────────────────────────────┘          │
│              │                                      │                          │
│              │  PCIe                                │  PCIe                    │
│              ▼                                      ▼                          │
│  ┌───────────────────────────────────────────────────────────────────────┐    │
│  │                           PCIe设备层                                   │    │
│  │  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐    │    │
│  │  │ NIC  │ │ GPU  │ │ NVMe │ │ HBA  │ │FPGA  │ │ SSD  │ │ ...  │    │    │
│  │  └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘    │    │
│  └───────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 处理器架构

### CPU微架构

```yaml
CPU微架构组件:
  前端单元 (Front End):
    指令获取:
      - 指令缓存 (I-Cache): 32KB/核心 (典型)
      - 分支预测器: 高精度预测分支走向
      - 指令解码器: x86→μops转换
      
    预取单元:
      - 硬件预取: L1/L2/L3多级预取
      - 流预取: 检测顺序访问模式
      - 步进预取: 检测固定步长模式
      
  执行单元 (Execution Engine):
    调度器:
      - 乱序执行: 动态重排序指令
      - 寄存器重命名: 消除假依赖
      - 保留站: 等待操作数就绪
      
    执行端口:
      - 整数运算单元 (ALU)
      - 浮点运算单元 (FPU)
      - 向量运算单元 (AVX-512)
      - 加载/存储单元
      
  后端单元 (Back End):
    重排序缓冲区 (ROB):
      - 保持程序顺序
      - 支持推测执行
      - 异常精确处理
      
    提交单元:
      - 指令退役
      - 结果写回
      - 状态更新
```

### 多核架构与缓存层次

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        CPU缓存层次结构                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Core 0                   Core 1                   Core N                   │
│  ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐       │
│  │   L1I    L1D    │     │   L1I    L1D    │     │   L1I    L1D    │       │
│  │   32KB   48KB   │     │   32KB   48KB   │     │   32KB   48KB   │       │
│  │   延迟:4周期    │     │   延迟:4周期    │     │   延迟:4周期    │       │
│  └────────┬────────┘     └────────┬────────┘     └────────┬────────┘       │
│           │                       │                       │                 │
│  ┌────────▼────────┐     ┌────────▼────────┐     ┌────────▼────────┐       │
│  │      L2         │     │      L2         │     │      L2         │       │
│  │    1.25MB       │     │    1.25MB       │     │    1.25MB       │       │
│  │   延迟:12周期   │     │   延迟:12周期   │     │   延迟:12周期   │       │
│  └────────┬────────┘     └────────┬────────┘     └────────┬────────┘       │
│           │                       │                       │                 │
│           └───────────────────────┼───────────────────────┘                 │
│                                   │                                         │
│                                   ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        L3 Cache (共享)                               │   │
│  │                    30MB ~ 60MB (典型)                                │   │
│  │                    延迟: 40-50周期                                   │   │
│  │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │   │
│  │  │Slice│ │Slice│ │Slice│ │Slice│ │Slice│ │Slice│ │Slice│ │Slice│ │   │
│  │  │  0  │ │  1  │ │  2  │ │  3  │ │  4  │ │  5  │ │  6  │ │  7  │ │   │
│  │  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                         │
│                                   ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        主内存 (DRAM)                                 │   │
│  │                    延迟: 80-120ns                                    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 缓存一致性协议

```yaml
MESI协议状态:
  Modified (M):
    描述: 缓存行被修改，与主存不一致
    独占: 是
    有效: 是
    动作: 写回主存后可共享
    
  Exclusive (E):
    描述: 缓存行与主存一致，独占
    独占: 是
    有效: 是
    动作: 可直接修改为M状态
    
  Shared (S):
    描述: 缓存行与主存一致，可能多核共享
    独占: 否
    有效: 是
    动作: 修改前需发送无效化请求
    
  Invalid (I):
    描述: 缓存行无效
    独占: 否
    有效: 否
    动作: 读取需从主存或其他缓存获取

MESIF协议扩展 (Intel):
  Forward (F):
    描述: 指定一个核心负责响应读请求
    作用: 减少多核读取时的响应冲突
    
缓存一致性开销:
  假共享 (False Sharing):
    问题: 不同变量在同一缓存行导致无效化
    影响: 严重性能下降
    解决: 缓存行对齐、填充变量
    
  缓存行大小: 64字节 (典型)
```

## NUMA架构

### NUMA拓扑结构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         NUMA架构拓扑图                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────────────────────┐    ┌──────────────────────────────┐      │
│  │       NUMA Node 0           │    │       NUMA Node 1           │      │
│  │  ┌─────────────────────┐    │    │  ┌─────────────────────┐    │      │
│  │  │      CPU 0          │    │    │  │      CPU 1          │    │      │
│  │  │   (多核心)          │    │    │  │   (多核心)          │    │      │
│  │  └──────────┬──────────┘    │    │  └──────────┬──────────┘    │      │
│  │             │               │    │             │               │      │
│  │  ┌──────────▼──────────┐    │    │  ┌──────────▼──────────┐    │      │
│  │  │   Local Memory      │    │    │  │   Local Memory      │    │      │
│  │  │   (本地内存)        │    │◄══════►│   (本地内存)        │    │      │
│  │  │   访问延迟: ~80ns   │    │ UPI/QPI│   访问延迟: ~80ns   │    │      │
│  │  └─────────────────────┘    │        │  └─────────────────────┘    │      │
│  │             │               │        │             │               │      │
│  │  ┌──────────▼──────────┐    │        │  ┌──────────▼──────────┐    │      │
│  │  │   PCIe Root        │    │        │  │   PCIe Root        │    │      │
│  │  │   Complex          │    │        │  │   Complex          │    │      │
│  │  └─────────────────────┘    │        │  └─────────────────────┘    │      │
│  └──────────────────────────────┘        └──────────────────────────────┘      │
│                                                                             │
│  远程内存访问延迟: ~120-150ns (1跳)                                         │
│  NUMA距离: 本地=10, 远程=21 (典型)                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### NUMA内存访问延迟

| 访问类型 | 延迟 | 带宽影响 | 适用场景 |
|----------|------|----------|----------|
| 本地L1缓存 | ~1ns | - | 热点数据 |
| 本地L2缓存 | ~4ns | - | 工作集 |
| 本地L3缓存 | ~15ns | - | 频繁访问 |
| 本地内存 | ~80ns | 100% | 常规访问 |
| 远程内存(1跳) | ~130ns | ~70% | 跨节点访问 |
| 远程内存(2跳) | ~180ns | ~50% | 多跳访问 |

### NUMA优化策略

```python
# Linux NUMA优化配置
class NUMAOptimizer:
    """NUMA优化配置管理"""
    
    def __init__(self):
        self.numa_nodes = self.detect_numa_topology()
        
    def detect_numa_topology(self):
        """检测NUMA拓扑"""
        import subprocess
        result = subprocess.run(['numactl', '--hardware'], 
                              capture_output=True, text=True)
        return self.parse_numa_output(result.stdout)
    
    def configure_memory_policy(self, policy, nodes=None):
        """配置内存分配策略"""
        policies = {
            'local': '--localalloc',      # 优先本地分配
            'interleave': '--interleave', # 交错分配
            'bind': '--membind',          # 绑定到指定节点
            'preferred': '--preferred'    # 首选节点
        }
        
        if policy == 'bind' and nodes:
            return f"numactl {policies[policy]}={','.join(map(str, nodes))}"
        elif policy == 'interleave' and nodes:
            return f"numactl {policies[policy]}={','.join(map(str, nodes))}"
        else:
            return f"numactl {policies.get(policy, '--localalloc')}"
    
    def bind_process_to_node(self, pid, numa_node):
        """绑定进程到NUMA节点"""
        import os
        cpus = self.get_cpus_for_node(numa_node)
        os.sched_setaffinity(pid, cpus)
        
    def configure_hugepages(self, node, pages_count, page_size='2M'):
        """配置大页内存"""
        path = f"/sys/devices/system/node/node{node}/hugepages/"
        if page_size == '2M':
            path += "hugepages-2048kB/nr_hugepages"
        elif page_size == '1G':
            path += "hugepages-1048576kB/nr_hugepages"
            
        with open(path, 'w') as f:
            f.write(str(pages_count))
```

## 内存子系统

### DDR内存架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         DDR5内存架构                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        DIMM模组                                      │   │
│  │  ┌──────────────────────────────────────────────────────────────┐   │   │
│  │  │                    DDR5 DIMM结构                              │   │   │
│  │  │                                                               │   │   │
│  │  │  ┌─────────────────┐    ┌─────────────────┐                  │   │   │
│  │  │  │   Sub-Channel A │    │   Sub-Channel B │  (双通道设计)    │   │   │
│  │  │  │   32-bit 数据   │    │   32-bit 数据   │                  │   │   │
│  │  │  │   8-bit ECC     │    │   8-bit ECC     │                  │   │   │
│  │  │  └─────────────────┘    └─────────────────┘                  │   │   │
│  │  │                                                               │   │   │
│  │  │  特性:                                                        │   │   │
│  │  │  - 频率: DDR5-4800 ~ DDR5-6400                               │   │   │
│  │  │  - 容量: 单条16GB ~ 128GB                                    │   │   │
│  │  │  - 电压: 1.1V (降低功耗)                                     │   │   │
│  │  │  - 板载ECC: 提高可靠性                                       │   │   │
│  │  │  - PMIC: 电源管理IC集成                                      │   │   │
│  │  └──────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  服务器内存配置:                                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  内存类型         │ 容量范围      │ 速度          │ 纠错能力       │   │
│  │  ─────────────────┼───────────────┼───────────────┼─────────────── │   │
│  │  UDIMM           │ 8-64GB        │ DDR5-4800+    │ 可选ECC        │   │
│  │  RDIMM           │ 16-128GB      │ DDR5-4800+    │ 标配ECC        │   │
│  │  LRDIMM          │ 64-256GB      │ DDR5-4800+    │ 标配ECC        │   │
│  │  NVDIMM          │ 16-512GB      │ DDR4/5        │ ECC+持久化     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 内存通道与带宽

```yaml
内存带宽计算:
  公式: 带宽 = 频率 × 位宽 × 通道数 / 8
  
  DDR5-4800示例:
    单通道带宽: 4800 × 64 / 8 = 38.4 GB/s
    八通道带宽: 38.4 × 8 = 307.2 GB/s
    
  服务器平台内存配置:
    Intel Xeon (4th Gen):
      通道数: 8通道/CPU
      最大频率: DDR5-4800
      最大容量: 4TB/CPU
      带宽: 307.2 GB/s/CPU
      
    AMD EPYC (4th Gen):
      通道数: 12通道/CPU
      最大频率: DDR5-4800
      最大容量: 6TB/CPU
      带宽: 460.8 GB/s/CPU

内存性能优化:
  通道平衡:
    - 每通道安装相同数量DIMM
    - 避免不对称配置
    
  Rank配置:
    - 单Rank: 最低延迟
    - 双Rank: 平衡性能与容量
    - 四Rank: 最大容量，略增延迟
    
  内存交错:
    - 跨通道交错: 提高带宽利用
    - 跨Rank交错: 隐藏延迟
```

## PCIe总线架构

### PCIe代际演进

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        PCIe代际演进对比                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  版本    │ 发布年份 │ 编码方式  │ 单通道带宽  │ x16带宽    │ 典型应用     │
│  ────────┼──────────┼───────────┼─────────────┼────────────┼────────────  │
│  PCIe 1.0│   2003   │ 8b/10b   │   250 MB/s  │   4 GB/s   │ 早期显卡    │
│  PCIe 2.0│   2007   │ 8b/10b   │   500 MB/s  │   8 GB/s   │ SATA SSD    │
│  PCIe 3.0│   2010   │ 128b/130b │   1 GB/s    │  16 GB/s   │ NVMe SSD    │
│  PCIe 4.0│   2017   │ 128b/130b │   2 GB/s    │  32 GB/s   │ 高性能SSD   │
│  PCIe 5.0│   2019   │ 128b/130b │   4 GB/s    │  64 GB/s   │ GPU/加速器  │
│  PCIe 6.0│   2022   │ PAM4     │   8 GB/s    │ 128 GB/s   │ AI加速器    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### PCIe拓扑结构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        服务器PCIe拓扑                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                         ┌─────────────────┐                                 │
│                         │      CPU        │                                 │
│                         │  PCIe控制器     │                                 │
│                         │  (Root Complex) │                                 │
│                         └────────┬────────┘                                 │
│                                  │                                          │
│           ┌──────────────────────┼──────────────────────┐                  │
│           │                      │                      │                  │
│           ▼                      ▼                      ▼                  │
│  ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐          │
│  │   PCIe Switch   │   │  直连PCIe槽     │   │  直连PCIe槽     │          │
│  │   (扩展器)      │   │  x16 Gen5       │   │  x16 Gen5       │          │
│  └────────┬────────┘   └────────┬────────┘   └────────┬────────┘          │
│           │                     │                     │                    │
│     ┌─────┼─────┐               │                     │                    │
│     │     │     │               │                     │                    │
│     ▼     ▼     ▼               ▼                     ▼                    │
│  ┌─────┐┌─────┐┌─────┐    ┌─────────┐          ┌─────────┐               │
│  │NVMe ││NVMe ││NIC  │    │  GPU    │          │  FPGA   │               │
│  │SSD 1││SSD 2││100G │    │ A100    │          │ U200    │               │
│  │x4   ││x4   ││x16  │    │ x16     │          │ x16     │               │
│  └─────┘└─────┘└─────┘    └─────────┘          └─────────┘               │
│                                                                             │
│  PCIe通道分配:                                                              │
│  - 直连CPU: 最低延迟，用于GPU/高性能设备                                    │
│  - 经Switch: 增加灵活性，略增延迟                                           │
│  - PCH下挂: SATA/USB/低速设备                                               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 服务器管理架构

### BMC与IPMI

```yaml
BMC (Baseboard Management Controller):
  功能:
    远程管理:
      - 电源控制 (开/关/重启)
      - KVM over IP (远程控制台)
      - 虚拟媒体 (ISO挂载)
      - 串口重定向 (SOL)
      
    监控告警:
      - 温度监控 (CPU/内存/系统)
      - 电压监控 (各路电源)
      - 风扇转速监控
      - 功耗监控
      
    固件管理:
      - BIOS更新
      - BMC固件更新
      - 设备固件更新
      
    日志管理:
      - 系统事件日志 (SEL)
      - 传感器数据记录 (SDR)
      - 故障诊断日志
      
  接口协议:
    IPMI (Intelligent Platform Management Interface):
      版本: IPMI 2.0
      功能: 标准化管理接口
      
    Redfish:
      版本: Redfish 1.x
      特点: RESTful API，JSON格式
      优势: 现代化、可扩展
      
    厂商私有:
      Dell: iDRAC
      HPE: iLO
      Lenovo: XClarity
      Inspur: BMC Web

BMC网络配置示例:
  # ipmitool配置BMC网络
  ipmitool lan set 1 ipsrc static
  ipmitool lan set 1 ipaddr 192.168.1.100
  ipmitool lan set 1 netmask 255.255.255.0
  ipmitool lan set 1 defgw ipaddr 192.168.1.1
```

### Redfish API示例

```python
# Redfish远程管理API调用
import requests
import json

class RedfishClient:
    """Redfish API客户端"""
    
    def __init__(self, host, username, password):
        self.base_url = f"https://{host}/redfish/v1"
        self.session = requests.Session()
        self.session.auth = (username, password)
        self.session.verify = False
        
    def get_system_info(self):
        """获取系统信息"""
        response = self.session.get(f"{self.base_url}/Systems/1")
        return response.json()
    
    def get_power_state(self):
        """获取电源状态"""
        system = self.get_system_info()
        return system.get('PowerState')
    
    def set_power_state(self, state):
        """设置电源状态"""
        # state: On, ForceOff, GracefulShutdown, ForceRestart
        payload = {"ResetType": state}
        response = self.session.post(
            f"{self.base_url}/Systems/1/Actions/ComputerSystem.Reset",
            json=payload
        )
        return response.status_code == 200
    
    def get_sensors(self):
        """获取传感器数据"""
        sensors = []
        
        # 获取温度传感器
        thermal = self.session.get(f"{self.base_url}/Chassis/1/Thermal")
        for temp in thermal.json().get('Temperatures', []):
            sensors.append({
                'name': temp['Name'],
                'type': 'temperature',
                'value': temp['ReadingCelsius'],
                'unit': '°C',
                'status': temp['Status']['Health']
            })
            
        # 获取电源信息
        power = self.session.get(f"{self.base_url}/Chassis/1/Power")
        for ps in power.json().get('PowerSupplies', []):
            sensors.append({
                'name': ps['Name'],
                'type': 'power',
                'value': ps.get('PowerOutputWatts'),
                'unit': 'W',
                'status': ps['Status']['Health']
            })
            
        return sensors
    
    def update_firmware(self, firmware_path):
        """更新固件"""
        with open(firmware_path, 'rb') as f:
            files = {'UpdateFile': f}
            response = self.session.post(
                f"{self.base_url}/UpdateService/Actions/UpdateService.SimpleUpdate",
                files=files
            )
        return response.json()
```

## 服务器可靠性设计

### RAS特性

```yaml
RAS (Reliability, Availability, Serviceability):
  可靠性 (Reliability):
    ECC内存:
      SECDED: 单比特纠错，双比特检测
      Chipkill: 整颗芯片失效容忍
      DDR5 On-Die ECC: 芯片级纠错
      
    CPU保护:
      MCA (Machine Check Architecture): 硬件错误检测
      CMCI: 可纠正错误中断
      Patrol Scrubbing: 内存巡检
      
    存储保护:
      RAID: 磁盘冗余
      热备盘: 自动替换故障盘
      端到端数据保护: T10-DIF/DIX
      
  可用性 (Availability):
    热插拔:
      - 电源热插拔
      - 风扇热插拔
      - 硬盘热插拔
      - PCIe热插拔 (部分)
      
    冗余设计:
      - 冗余电源 (1+1, 2+1, 2+2)
      - 冗余风扇 (N+1)
      - 冗余网络 (双链路)
      - 冗余BMC网络
      
    故障隔离:
      - PCIe AER (高级错误报告)
      - Memory Sparing (内存备用)
      - CPU降级运行
      
  可维护性 (Serviceability):
    诊断功能:
      - LED状态指示
      - 显示屏错误码
      - 远程诊断
      - 预测性故障分析
      
    维护便利:
      - 免工具拆装
      - 组件标签
      - 服务手册
      - 配件编码
```

### 内存RAS功能

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        内存RAS功能层次                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ECC (Error Correcting Code)                                         │   │
│  │  - SECDED: 纠正1位错误，检测2位错误                                  │   │
│  │  - 标准配置: 64位数据 + 8位校验                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    ↓                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  Memory Scrubbing (内存巡检)                                         │   │
│  │  - Patrol Scrubbing: 后台持续巡检，纠正单比特错误                   │   │
│  │  - Demand Scrubbing: 访问时检查纠错                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    ↓                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  SDDC (Single Device Data Correction)                                │   │
│  │  - 单颗DRAM芯片完全失效仍可纠错                                     │   │
│  │  - x4 SDDC: 使用x4芯片实现                                           │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    ↓                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ADDDC (Adaptive Double Device Data Correction)                      │   │
│  │  - 两颗DRAM芯片失效仍可继续工作                                     │   │
│  │  - 动态适应故障模式                                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    ↓                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  Memory Sparing (内存备用)                                           │   │
│  │  - Rank Sparing: 备用Rank替换故障Rank                               │   │
│  │  - Partial Sparing: 部分行替换                                       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    ↓                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  Memory Mirroring (内存镜像)                                         │   │
│  │  - 全镜像: 50%容量，最高可靠性                                       │   │
│  │  - 部分镜像: 关键区域镜像                                            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 参考资源

- [Intel Xeon Scalable Processors Technical Overview](https://www.intel.com/xeon)
- [AMD EPYC Processors Architecture](https://www.amd.com/epyc)
- [PCI-SIG PCIe Specifications](https://pcisig.com/)
- [JEDEC DDR5 Standard](https://www.jedec.org/)
- [DMTF Redfish Specification](https://www.dmtf.org/redfish)
- [IPMI Specification](https://www.intel.com/ipmi)
